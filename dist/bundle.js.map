{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///(webpack)/buildin/global.js","webpack:///./node_modules/promise-polyfill/src/index.js","webpack:///./node_modules/promise-polyfill/src/finally.js","webpack:///./node_modules/promise-polyfill/src/allSettled.js","webpack:///./node_modules/error-stack-parser/error-stack-parser.js","webpack:///./node_modules/timers-browserify/main.js","webpack:///./node_modules/setimmediate/setImmediate.js","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/stackframe/stackframe.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/polyfills.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/utils.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/patching/patch-utils.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/constants.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/patching/xhr-patch.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/http/response-status.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/http/fetch.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/event-handler.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/patching/index.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/patching/fetch-patch.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/patching/history-patch.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/state.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/bootstrap.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/error-logging/stack-trace.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/url.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/context.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/truncate.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/error-logging/error-logging.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/queue.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/ndjson.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/performance-monitoring/span-base.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/performance-monitoring/span.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/performance-monitoring/capture-navigation.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/compress.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/http/xhr.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/apm-server.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/throttle.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/config-service.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/service-factory.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/logging-service.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/performance-monitoring/performance-monitoring.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/performance-monitoring/breakdown.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/performance-monitoring/transaction.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/performance-monitoring/metrics.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/performance-monitoring/transaction-service.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/index.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/performance-monitoring/index.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/error-logging/index.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/observers/page-visibility.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/observers/page-clicks.js","webpack:///./node_modules/@elastic/apm-rum/dist/es/apm-base.js","webpack:///./node_modules/@elastic/apm-rum-core/dist/es/common/instrument.js","webpack:///./node_modules/@elastic/apm-rum/dist/es/index.js","webpack:///./src/apm.js","webpack:///./src/poll.js","webpack:///./src/custom-span.js","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","g","this","Function","e","window","setTimeoutFunc","setTimeout","isArray","x","Boolean","length","noop","Promise","fn","TypeError","_state","_handled","_value","undefined","_deferreds","doResolve","handle","self","deferred","_immediateFn","cb","onFulfilled","onRejected","ret","reject","promise","resolve","push","newValue","then","finale","thisArg","apply","arguments","_unhandledRejectionFn","len","Handler","done","reason","ex","prom","constructor","all","arr","args","Array","slice","remaining","res","val","allSettled","race","setImmediate","err","console","warn","callback","status","StackFrame","FIREFOX_SAFARI_STACK_REGEXP","CHROME_IE_STACK_REGEXP","SAFARI_NATIVE_CODE_REGEXP","_map","array","map","output","_filter","filter","_indexOf","target","indexOf","parse","error","stacktrace","parseOpera","stack","match","parseV8OrIE","parseFFOrSafari","Error","extractLocation","urlLike","parts","exec","replace","split","line","tokens","locationParts","pop","functionName","join","fileName","message","parseOpera9","parseOpera11","parseOpera10","lineRE","lines","result","argsRaw","functionCall","shift","Timeout","id","clearFn","_id","_clearFn","scope","clearTimeout","setInterval","clearInterval","timeout","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","global","clearImmediate","registerImmediate","html","channel","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","document","attachTo","getPrototypeOf","toString","process","nextTick","runIfPresent","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","event","data","port2","createElement","documentElement","script","onreadystatechange","removeChild","appendChild","Math","random","source","addEventListener","attachEvent","task","run","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","currentQueue","queue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","marker","runClearTimeout","Item","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","_isNumber","isNaN","parseFloat","isFinite","lineNumber","columnNumber","setFunctionName","setArgs","setFileName","setLineNumber","setColumnNumber","setSource","getFunctionName","v","String","getArgs","getFileName","getLineNumber","Number","getColumnNumber","getSource","local","isBrowser","PERF","performance","byteToHex","substr","Uint8Array","generateRandomId","buffer","hexOctets","_i","bytesToHex","crypto","getRandomValues","msCrypto","setRequestHeader","headers","append","checkSameOrigin","isSame","test","forEach","isPlatformSupported","Set","JSON","stringify","now","XMLHttpRequest","setLabel","obj","skey","removeInvalidChars","valueType","stripQueryStringFromUrl","url","isObject","baseExtend","dst","objs","deep","ii","keys","j","jj","src","getCurrentScript","currentScript","scripts","getElementsByTagName","sc","getElasticScript","extend","isUndefined","getLatestSpan","spans","typeFilter","latestSpan","_i3","span","type","_end","getTime","time","getDuration","start","end","parseInt","scheduleMicroTask","isPerfTimelineSupported","getEntriesByType","isPerfTypeSupported","PerformanceObserver","supportedEntryTypes","globalState","fetchInProgress","apmSymbol","patchMethod","patchFn","proto","delegate","patched","original","propertyDesc","delegateName","desc","getOwnPropertyDescriptor","writable","set","patchDelegate","XHR_IGNORE","XHR_SYNC","XHR_URL","XHR_METHOD","SCHEDULE","INVOKE","RESOURCE_INITIATOR_TYPES","MAX_SPAN_DURATION","PAGE_LOAD","TYPE_CUSTOM","USER_INTERACTION","HTTP_REQUEST_TYPE","TEMPORARY_TYPE","NAME_UNKNOWN","TRANSACTION_TYPE_ORDER","TRANSACTION_END","CONFIG_CHANGE","QUEUE_FLUSH","QUEUE_ADD_TRANSACTION","XMLHTTPREQUEST","FETCH","HISTORY","AFTER_EVENT","LOCAL_CONFIG_KEY","LONG_TASK","LARGEST_CONTENTFUL_PAINT","FIRST_INPUT","LAYOUT_SHIFT","CONFIG_SERVICE","LOGGING_SERVICE","TRANSACTION_SERVICE","APM_SERVER","PERFORMANCE_MONITORING","ERROR_LOGGING","TRUNCATED_TYPE","KEYWORD_LIMIT","patchXMLHttpRequest","XMLHttpRequestPrototype","READY_STATE_CHANGE","LOAD","ERROR","openNative","sendNative","state","method","sync","_ref","readyState","invokeTask","scheduleTask","isResponseSuccessful","_extends","assign","shouldUseFetchWithKeepAlive","payload","isFetchSupported","Request","size","Blob","calculateSize","fetch","EventHandler","observers","_proto","observe","_this","index","splice","sendOnly","obs","log","send","patchEventHandler","alreadyPatched","patchAll","nativeFetch","input","init","request","fetchSelf","aborted","response","clonedResponse","clone","body","readStream","handleResponseError","isAbortError","stream","reader","getReader","read","patchFetch","history","nativePushState","pushState","patchHistory","__DEV__","bootstrapTime","lastHiddenStart","MIN_SAFE_INTEGER","createStackTraces","stackParser","errorEvent","filename","lineno","colno","stackTraces","isValidStackTrace","frame","fnName","_stack$functionName","fileUrl","origin","filePath","cleanFilePath","cleanedFileName","location","protocol","hostname","port","href","isFileInline","abs_path","function","RULES","NaN","PROTOCOL_REGEX","Url","_this$extractProtocol","extractProtocol","address","slashes","relative","getLocation","instructions","instruction","instLength","newIndex","lastIndexOf","max","toLowerCase","path","charAt","host","isDefaultPort","auth","REDACTED","userpass","query","hash","globalVar","_excluded","getResponseContext","perfTimingEntry","respContext","transfer_size","transferSize","encoded_body_size","encodedBodySize","decoded_body_size","decodedBodySize","serverTimingStr","serverTimingEntries","serverTimingInfo","_i2","_serverTimingEntries$","duration","description","timingValue","valueSeparator","getServerTimingInfo","serverTiming","getDestination","parsedUrl","portNumber","getPortNumber","ipv6Hostname","charCodeAt","service","resource","getPageContext","page","referer","referrer","addSpanContext","context","statusCode","destination","http","status_code","getExternalContext","entry","getResourceContext","getNavigationContext","addContext","addTransactionContext","transaction","_temp","configContext","tags","excluded","sourceKeys","_objectWithoutPropertiesLoose","pageContext","responseContext","entries","METADATA_MODEL","agent","environment","labels","RESPONSE_MODEL","CONTEXT_MODEL","user","email","username","SPAN_MODEL","trace_id","parent_id","transaction_id","subtype","action","TRANSACTION_MODEL","span_count","started","ERROR_MODEL","culprit","exception","isEmpty","replaceValue","currModel","limit","required","placeholder","substring","truncate","truncateModel","model","childTarget","emptyArr","_loop","currKey","IGNORE_KEYS","ErrorLogging","apmServer","configService","transactionService","_apmServer","_configService","_transactionService","createErrorDataModel","filteredFrames","frames","filterInvalidFrames","lastFrame","errorMessage","errorType","errorContext","customProperties","propertyFound","properties","toISOString","getErrorProperties","custom","currentTransaction","getCurrentTransaction","transactionContext","_this$_configService$","errorObject","traceId","sampled","logErrorEvent","addError","registerListeners","promiseRejectionEvent","logPromiseEvent","prefix","logError","messageOrError","Queue","onFlush","opts","items","queueLimit","flushInterval","timeoutId","_setTimer","flush","_clear","add","NDJSON","SpanBase","options","sampleRate","timestamp","_start","startTime","ended","outcome","onEnd","ensureContext","addLabels","ctx","k","_len","_key","endTime","callOnEnd","_setPrototypeOf","setPrototypeOf","__proto__","_SpanBase","subClass","superClass","Span","parentId","fields","eventPairs","shouldCreateSpan","trStart","trEnd","baseTime","createResourceTimingSpan","resourceTimingEntry","initiatorType","responseEnd","kind","spanName","isCapturedByPatching","resourceStartTime","requestPatchTime","NAVIGATION_TIMING_MARKS","COMPRESSED_NAV_TIMING_MARKS","getPageLoadMarks","timing","marks","fetchStart","navigationStart","responseStart","timingKey","getNavigationTimingMarks","navigationTiming","timeToFirstByte","domInteractive","domComplete","captureNavigation","captureTimings","customMarks","timings","pageResponse","createNavigationTimingSpans","pageLoadSpanId","addMarks","_trStart","_entries$i","createResourceTimingSpans","userTimingSpans","_entries$i2","createUserTimingSpans","compressResponse","ts","ebs","dbs","compressContext","compressed","rf","h","mt","compressHTTP","dt","se","rc","ad","po","u","un","em","cu","compressMarks","compressedNtMarks","ntMarks","mark","mapping","compressNavigationTimingMarks","nt","a","compressAgentMarks","agentMarks","fb","rs","di","dc","fp","firstContentfulPaint","lp","largestContentfulPaint","compressPayload","params","isCompressionStreamSupported","CompressionStream","flagName","sessionStorage","getItem","URL","URLSearchParams","isFlagSet","searchParams","has","setItem","isBeaconInspectionEnabled","beforeSend","compressedStream","pipeThrough","Response","blob","sendXHR","_ref$timeout","HTTP_REQUEST_TIMEOUT","sendCredentials","xhr","open","withCredentials","header","responseText","onerror","canSend","ApmServer","loggingService","_loggingService","throttleEvents","events","sendEvents","catch","_constructError","onThrottle","interval","counter","throttle","observeEvent","_postJson","endPoint","_this2","_makeHttpRequest","_ref2","_ref2$timeout","fetchResponse","_ref$keepalive","keepalive","timeoutConfig","AbortController","controller","signal","abort","credentials","text","bodyResponse","sendFetchRequest","fetchConfig","serviceName","_this3","configEndpoint","getEndpoints","localConfig","getLocalConfig","etag","apmRequest","remoteConfig","getResponseHeader","setLocalConfig","createMetaData","cfg","metadata","language","_this$throttleEvents","addTransaction","_this$throttleEvents2","ndjsonErrors","errors","compress","_NDJSON$stringify","cl","mg","st","ap","f","li","co","tid","pid","xid","sm","compressError","ndjsonMetricsets","metricsets","metricset","ndjsonTransactions","transactions","_this4","tr","_NDJSON$stringify2","breakdowns","breakdown","spanData","sr","sample_rate","sy","su","ac","me","samples","y","sa","ysc","yss","xdc","xds","xbc","yc","sd","experience","_transaction$experien","cls","fid","tbt","longtask","exp","lt","session","_transaction$session","sequence","ses","seq","compressTransaction","_payload","_NDJSON$stringify3","filteredPayload","applyFilters","ndjson","metadataKey","ve","la","en","compressMetadata","ndjsonPayload","intakeEndpoint","serverUrl","apiVersion","_serviceCreators","Config","config","serviceVersion","serverUrlPrefix","instrument","disableInstrumentations","logLevel","breakdownMetrics","ignoreTransactions","eventsLimit","distributedTracing","distributedTracingOrigins","distributedTracingHeaderName","pageLoadTraceId","pageLoadSampled","pageLoadTransactionName","propagateTracestate","transactionSampleRate","centralConfig","monitorLongtasks","filters","scriptData","node","dataAttrs","dataRegex","attrs","attributes","attr","nodeName","toUpperCase","nodeValue","getDataAttributesFromNode","setConfig","setVersion","addFilter","reduce","objKey","setUserContext","userContext","_userContext","setCustomContext","customContext","_properties","round","validate","requiredKeys","allKeys","missing","invalid","unknown","allowed","storage","localStorage","merge","dispatchEvent","LoggingService","spec","levels","level","resetLogMethods","shouldLog","setLevel","normalizedLevel","realMethod","serviceCreators","factory","_factory$getService","getService","ServiceFactory","instances","initialized","_this$getService","PerformanceMonitoring","_logginService","flags","createTransactionPayload","getHistorySub","getXHRSub","getFetchSub","startTransaction","managed","canReuse","processAPICalls","endpoints","some","endpoint","requestUrl","startSpan","blocking","isDtEnabled","dtOrigins","currentUrl","isSameOrigin","injectDtHeader","injectTSHeader","_data","_span","_target","endSpan","headerName","headerValue","dtVersion","getDtHeaderValue","getTSHeaderValue","extractDtHeader","parsed","parseDtHeaderValue","filterTransaction","isManaged","createTransactionDataModel","transactionStart","transactionData","breakdownTimings","adjustedTransaction","filterdSpans","similarSpans","originalSpans","transDuration","threshold","sort","spanA","spanB","lastCount","lastSpan","isContinuouslySimilar","isLastSpan","groupSmallContinuouslySimilarSpans","resetFields","adjustTransaction","pageLoadBreakdowns","getValue","getSpanBreakdown","transactionDetails","details","_ref$count","count","trDuration","current","spanMap","transactionSelfTime","span1","span2","spanEnd","spanStart","lastContinuousEnd","selfTime","calculateSelfTime","groupSpans","_key$split","_spanMap$key","Transaction","_activeSpans","_activeTasks","blocked","markTime","reuseThreshold","redefine","trc","_onSpanEnd","addTask","isFinished","detectFinish","sid","captureBreakdown","block","flag","taskId","removeTask","delete","metrics","fcp","Infinity","score","firstEntryTime","NEGATIVE_INFINITY","prevEntryTime","currentSessionScore","captureObserverEntries","list","isHardNavigation","longtaskEntries","longtasks","agg","_longtasks$i","attribution","_attribution$","_name","containerType","containerName","containerId","createLongTaskSpans","lcpEntries","lastLcpEntry","lcp","unloadDiff","fcpEntry","getEntriesByName","fidSpan","fidEntries","firstInput","processingStart","createFirstInputDelaySpan","min","blockingTime","calculateTotalBlockingTime","clsEntries","hadRecentInput","calculateCumulativeLayoutShift","PerfEntryRecorder","disconnect","buffered","_","stop","TransactionService","logger","_config","_logger","respIntervalId","recorder","_tr$spans","_captureObserverEntri","createCurrentTransaction","createOptions","perfOptions","startManagedTransaction","isRedefined","redefineType","currentTypeOrder","redefineTypeOrder","fireOnstartHook","handleTransactionEnd","shouldIgnoreTransaction","tbtObject","tbtSpan","sum","setSession","urlStr","depth","pathParts","redactString","specialCharsRegex","digitsRegex","lowerCaseRegex","upperCaseRegex","redactedParts","redactedBefore","part","numberOfDigits","numberofUpperCase","lowerCaseRate","upperCaseRate","slugifyUrl","adjustTransactionTime","Date","sessionConfig","earliestSpan","_i4","getEarliestSpan","getLatestNonXHRSpan","latestSpanEnd","transactionEndWithoutDelay","latestXHRSpan","getLatestXHRSpan","latestXHRSpanEnd","truncateSpans","transactionEnd","transactionName","ignoreList","element","createServiceFactory","serviceFactory","_serviceFactory$getSe","_serviceFactory$getSe2","onPageHidden","unobserve","observePageClicks","clickHandler","Element","_getTransactionMetada","tagName","dataset","getAttribute","classes","getTransactionMetadata","createUserInteractionTransaction","eventName","removeEventListener","ApmBase","disable","_disable","_initialized","isEnabled","isActive","_this$serviceFactory$","disabledInstrumentations","_flags","getInstrumentationFlags","sendPageLoad","_sendPageLoadMetrics","fetchCentralConfig","visibilityState","visibilityChangeHandler","pageHideHandler","useCapture","observePageVisibility","_this$serviceFactory$2","_config2","_invalid$","sendPageLoadMetrics","_this$serviceFactory$3","_configService$valida2","separator","_message","setInitialPageLoadName","captureError","elasticApm","enabled","apmBase","getApmBase","isPolling","async","poll","startPolling","measureTime","ms","floor","querySelector","innerHTML","imageBlob","imageObjectURL","createObjectURL","imageEl","setAttribute"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","import promiseFinally from './finally';\nimport allSettled from './allSettled';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction isArray(x) {\n  return Boolean(x && typeof x.length !== 'undefined');\n}\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.all accepts an array'));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.allSettled = allSettled;\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.race accepts an array'));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  // @ts-ignore\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      // @ts-ignore\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nexport default Promise;\n","/**\n * @this {Promise}\n */\nfunction finallyConstructor(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        // @ts-ignore\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nexport default finallyConstructor;\n","function allSettled(arr) {\n  var P = this;\n  return new P(function(resolve, reject) {\n    if (!(arr && typeof arr.length !== 'undefined')) {\n      return reject(\n        new TypeError(\n          typeof arr +\n            ' ' +\n            arr +\n            ' is not iterable(cannot read property Symbol(Symbol.iterator))'\n        )\n      );\n    }\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      if (val && (typeof val === 'object' || typeof val === 'function')) {\n        var then = val.then;\n        if (typeof then === 'function') {\n          then.call(\n            val,\n            function(val) {\n              res(i, val);\n            },\n            function(e) {\n              args[i] = { status: 'rejected', reason: e };\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            }\n          );\n          return;\n        }\n      }\n      args[i] = { status: 'fulfilled', value: val };\n      if (--remaining === 0) {\n        resolve(args);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n}\n\nexport default allSettled;\n","(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('error-stack-parser', ['stackframe'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('stackframe'));\n    } else {\n        root.ErrorStackParser = factory(root.StackFrame);\n    }\n}(this, function ErrorStackParser(StackFrame) {\n    'use strict';\n\n    var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+\\:\\d+/;\n    var CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+\\:\\d+|\\(native\\))/m;\n    var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code\\])?$/;\n\n    function _map(array, fn, thisArg) {\n        if (typeof Array.prototype.map === 'function') {\n            return array.map(fn, thisArg);\n        } else {\n            var output = new Array(array.length);\n            for (var i = 0; i < array.length; i++) {\n                output[i] = fn.call(thisArg, array[i]);\n            }\n            return output;\n        }\n    }\n\n    function _filter(array, fn, thisArg) {\n        if (typeof Array.prototype.filter === 'function') {\n            return array.filter(fn, thisArg);\n        } else {\n            var output = [];\n            for (var i = 0; i < array.length; i++) {\n                if (fn.call(thisArg, array[i])) {\n                    output.push(array[i]);\n                }\n            }\n            return output;\n        }\n    }\n\n    function _indexOf(array, target) {\n        if (typeof Array.prototype.indexOf === 'function') {\n            return array.indexOf(target);\n        } else {\n            for (var i = 0; i < array.length; i++) {\n                if (array[i] === target) {\n                    return i;\n                }\n            }\n            return -1;\n        }\n    }\n\n    return {\n        /**\n         * Given an Error object, extract the most information from it.\n         *\n         * @param {Error} error object\n         * @return {Array} of StackFrames\n         */\n        parse: function ErrorStackParser$$parse(error) {\n            if (typeof error.stacktrace !== 'undefined' || typeof error['opera#sourceloc'] !== 'undefined') {\n                return this.parseOpera(error);\n            } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\n                return this.parseV8OrIE(error);\n            } else if (error.stack) {\n                return this.parseFFOrSafari(error);\n            } else {\n                throw new Error('Cannot parse given Error object');\n            }\n        },\n\n        // Separate line and column numbers from a string of the form: (URI:Line:Column)\n        extractLocation: function ErrorStackParser$$extractLocation(urlLike) {\n            // Fail-fast but return locations like \"(native)\"\n            if (urlLike.indexOf(':') === -1) {\n                return [urlLike];\n            }\n\n            var regExp = /(.+?)(?:\\:(\\d+))?(?:\\:(\\d+))?$/;\n            var parts = regExp.exec(urlLike.replace(/[\\(\\)]/g, ''));\n            return [parts[1], parts[2] || undefined, parts[3] || undefined];\n        },\n\n        parseV8OrIE: function ErrorStackParser$$parseV8OrIE(error) {\n            var filtered = _filter(error.stack.split('\\n'), function(line) {\n                return !!line.match(CHROME_IE_STACK_REGEXP);\n            }, this);\n\n            return _map(filtered, function(line) {\n                if (line.indexOf('(eval ') > -1) {\n                    // Throw away eval information until we implement stacktrace.js/stackframe#8\n                    line = line.replace(/eval code/g, 'eval').replace(/(\\(eval at [^\\()]*)|(\\)\\,.*$)/g, '');\n                }\n                var tokens = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(').split(/\\s+/).slice(1);\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionName = tokens.join(' ') || undefined;\n                var fileName = _indexOf(['eval', '<anonymous>'], locationParts[0]) > -1 ? undefined : locationParts[0];\n\n                return new StackFrame(functionName, undefined, fileName, locationParts[1], locationParts[2], line);\n            }, this);\n        },\n\n        parseFFOrSafari: function ErrorStackParser$$parseFFOrSafari(error) {\n            var filtered = _filter(error.stack.split('\\n'), function(line) {\n                return !line.match(SAFARI_NATIVE_CODE_REGEXP);\n            }, this);\n\n            return _map(filtered, function(line) {\n                // Throw away eval information until we implement stacktrace.js/stackframe#8\n                if (line.indexOf(' > eval') > -1) {\n                    line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval\\:\\d+\\:\\d+/g, ':$1');\n                }\n\n                if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\n                    // Safari eval frames only have function names and nothing else\n                    return new StackFrame(line);\n                } else {\n                    var tokens = line.split('@');\n                    var locationParts = this.extractLocation(tokens.pop());\n                    var functionName = tokens.join('@') || undefined;\n                    return new StackFrame(functionName,\n                        undefined,\n                        locationParts[0],\n                        locationParts[1],\n                        locationParts[2],\n                        line);\n                }\n            }, this);\n        },\n\n        parseOpera: function ErrorStackParser$$parseOpera(e) {\n            if (!e.stacktrace || (e.message.indexOf('\\n') > -1 &&\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\n                return this.parseOpera9(e);\n            } else if (!e.stack) {\n                return this.parseOpera10(e);\n            } else {\n                return this.parseOpera11(e);\n            }\n        },\n\n        parseOpera9: function ErrorStackParser$$parseOpera9(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\n            var lines = e.message.split('\\n');\n            var result = [];\n\n            for (var i = 2, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(new StackFrame(undefined, undefined, match[2], match[1], undefined, lines[i]));\n                }\n            }\n\n            return result;\n        },\n\n        parseOpera10: function ErrorStackParser$$parseOpera10(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\n            var lines = e.stacktrace.split('\\n');\n            var result = [];\n\n            for (var i = 0, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(\n                        new StackFrame(\n                            match[3] || undefined,\n                            undefined,\n                            match[2],\n                            match[1],\n                            undefined,\n                            lines[i]\n                        )\n                    );\n                }\n            }\n\n            return result;\n        },\n\n        // Opera 10.65+ Error.stack very similar to FF/Safari\n        parseOpera11: function ErrorStackParser$$parseOpera11(error) {\n            var filtered = _filter(error.stack.split('\\n'), function(line) {\n                return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);\n            }, this);\n\n            return _map(filtered, function(line) {\n                var tokens = line.split('@');\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionCall = (tokens.shift() || '');\n                var functionName = functionCall\n                        .replace(/<anonymous function(: (\\w+))?>/, '$2')\n                        .replace(/\\([^\\)]*\\)/g, '') || undefined;\n                var argsRaw;\n                if (functionCall.match(/\\(([^\\)]*)\\)/)) {\n                    argsRaw = functionCall.replace(/^[^\\(]+\\(([^\\)]*)\\)$/, '$1');\n                }\n                var args = (argsRaw === undefined || argsRaw === '[arguments not available]') ?\n                    undefined : argsRaw.split(',');\n                return new StackFrame(\n                    functionName,\n                    args,\n                    locationParts[0],\n                    locationParts[1],\n                    locationParts[2],\n                    line);\n            }, this);\n        }\n    };\n}));\n\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","(function (root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('stackframe', [], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.StackFrame = factory();\n    }\n}(this, function () {\n    'use strict';\n    function _isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n\n    function StackFrame(functionName, args, fileName, lineNumber, columnNumber, source) {\n        if (functionName !== undefined) {\n            this.setFunctionName(functionName);\n        }\n        if (args !== undefined) {\n            this.setArgs(args);\n        }\n        if (fileName !== undefined) {\n            this.setFileName(fileName);\n        }\n        if (lineNumber !== undefined) {\n            this.setLineNumber(lineNumber);\n        }\n        if (columnNumber !== undefined) {\n            this.setColumnNumber(columnNumber);\n        }\n        if (source !== undefined) {\n            this.setSource(source);\n        }\n    }\n\n    StackFrame.prototype = {\n        getFunctionName: function () {\n            return this.functionName;\n        },\n        setFunctionName: function (v) {\n            this.functionName = String(v);\n        },\n\n        getArgs: function () {\n            return this.args;\n        },\n        setArgs: function (v) {\n            if (Object.prototype.toString.call(v) !== '[object Array]') {\n                throw new TypeError('Args must be an Array');\n            }\n            this.args = v;\n        },\n\n        // NOTE: Property name may be misleading as it includes the path,\n        // but it somewhat mirrors V8's JavaScriptStackTraceApi\n        // https://code.google.com/p/v8/wiki/JavaScriptStackTraceApi and Gecko's\n        // http://mxr.mozilla.org/mozilla-central/source/xpcom/base/nsIException.idl#14\n        getFileName: function () {\n            return this.fileName;\n        },\n        setFileName: function (v) {\n            this.fileName = String(v);\n        },\n\n        getLineNumber: function () {\n            return this.lineNumber;\n        },\n        setLineNumber: function (v) {\n            if (!_isNumber(v)) {\n                throw new TypeError('Line Number must be a Number');\n            }\n            this.lineNumber = Number(v);\n        },\n\n        getColumnNumber: function () {\n            return this.columnNumber;\n        },\n        setColumnNumber: function (v) {\n            if (!_isNumber(v)) {\n                throw new TypeError('Column Number must be a Number');\n            }\n            this.columnNumber = Number(v);\n        },\n\n        getSource: function () {\n            return this.source;\n        },\n        setSource: function (v) {\n            this.source = String(v);\n        },\n\n        toString: function() {\n            var functionName = this.getFunctionName() || '{anonymous}';\n            var args = '(' + (this.getArgs() || []).join(',') + ')';\n            var fileName = this.getFileName() ? ('@' + this.getFileName()) : '';\n            var lineNumber = _isNumber(this.getLineNumber()) ? (':' + this.getLineNumber()) : '';\n            var columnNumber = _isNumber(this.getColumnNumber()) ? (':' + this.getColumnNumber()) : '';\n            return functionName + args + fileName + lineNumber + columnNumber;\n        }\n    };\n\n    return StackFrame;\n}));\n","import PromisePollyfill from 'promise-polyfill';\nimport { isBrowser } from './utils';\nvar local = {};\n\nif (isBrowser) {\n  local = window;\n} else if (typeof self !== 'undefined') {\n  local = self;\n}\n\nvar Promise = 'Promise' in local ? local.Promise : PromisePollyfill;\nexport { Promise };","import { Promise } from './polyfills';\nvar slice = [].slice;\nvar isBrowser = typeof window !== 'undefined';\nvar PERF = isBrowser && typeof performance !== 'undefined' ? performance : {};\n\nfunction isCORSSupported() {\n  var xhr = new window.XMLHttpRequest();\n  return 'withCredentials' in xhr;\n}\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToHex(buffer) {\n  var hexOctets = [];\n\n  for (var _i = 0; _i < buffer.length; _i++) {\n    hexOctets.push(byteToHex[buffer[_i]]);\n  }\n\n  return hexOctets.join('');\n}\n\nvar destination = new Uint8Array(16);\n\nfunction rng() {\n  if (typeof crypto != 'undefined' && typeof crypto.getRandomValues == 'function') {\n    return crypto.getRandomValues(destination);\n  } else if (typeof msCrypto != 'undefined' && typeof msCrypto.getRandomValues == 'function') {\n    return msCrypto.getRandomValues(destination);\n  }\n\n  return destination;\n}\n\nfunction generateRandomId(length) {\n  var id = bytesToHex(rng());\n  return id.substr(0, length);\n}\n\nfunction getDtHeaderValue(span) {\n  var dtVersion = '00';\n  var dtUnSampledFlags = '00';\n  var dtSampledFlags = '01';\n\n  if (span && span.traceId && span.id && span.parentId) {\n    var flags = span.sampled ? dtSampledFlags : dtUnSampledFlags;\n    var id = span.sampled ? span.id : span.parentId;\n    return dtVersion + '-' + span.traceId + '-' + id + '-' + flags;\n  }\n}\n\nfunction parseDtHeaderValue(value) {\n  var parsed = /^([\\da-f]{2})-([\\da-f]{32})-([\\da-f]{16})-([\\da-f]{2})$/.exec(value);\n\n  if (parsed) {\n    var flags = parsed[4];\n    var sampled = flags !== '00';\n    return {\n      traceId: parsed[2],\n      id: parsed[3],\n      sampled: sampled\n    };\n  }\n}\n\nfunction isDtHeaderValid(header) {\n  return /^[\\da-f]{2}-[\\da-f]{32}-[\\da-f]{16}-[\\da-f]{2}$/.test(header) && header.slice(3, 35) !== '00000000000000000000000000000000' && header.slice(36, 52) !== '0000000000000000';\n}\n\nfunction getTSHeaderValue(_ref) {\n  var sampleRate = _ref.sampleRate;\n\n  if (typeof sampleRate !== 'number' || String(sampleRate).length > 256) {\n    return;\n  }\n\n  var NAMESPACE = 'es';\n  var SEPARATOR = '=';\n  return \"\" + NAMESPACE + SEPARATOR + \"s:\" + sampleRate;\n}\n\nfunction setRequestHeader(target, name, value) {\n  if (typeof target.setRequestHeader === 'function') {\n    target.setRequestHeader(name, value);\n  } else if (target.headers && typeof target.headers.append === 'function') {\n    target.headers.append(name, value);\n  } else {\n    target[name] = value;\n  }\n}\n\nfunction checkSameOrigin(source, target) {\n  var isSame = false;\n\n  if (typeof target === 'string') {\n    isSame = source === target;\n  } else if (target && typeof target.test === 'function') {\n    isSame = target.test(source);\n  } else if (Array.isArray(target)) {\n    target.forEach(function (t) {\n      if (!isSame) {\n        isSame = checkSameOrigin(source, t);\n      }\n    });\n  }\n\n  return isSame;\n}\n\nfunction isPlatformSupported() {\n  return isBrowser && typeof Set === 'function' && typeof JSON.stringify === 'function' && PERF && typeof PERF.now === 'function' && isCORSSupported();\n}\n\nfunction setLabel(key, value, obj) {\n  if (!obj || !key) return;\n  var skey = removeInvalidChars(key);\n  var valueType = typeof value;\n\n  if (value != undefined && valueType !== 'boolean' && valueType !== 'number') {\n    value = String(value);\n  }\n\n  obj[skey] = value;\n  return obj;\n}\n\nfunction getServerTimingInfo(serverTimingEntries) {\n  if (serverTimingEntries === void 0) {\n    serverTimingEntries = [];\n  }\n\n  var serverTimingInfo = [];\n  var entrySeparator = ', ';\n  var valueSeparator = ';';\n\n  for (var _i2 = 0; _i2 < serverTimingEntries.length; _i2++) {\n    var _serverTimingEntries$ = serverTimingEntries[_i2],\n        name = _serverTimingEntries$.name,\n        duration = _serverTimingEntries$.duration,\n        description = _serverTimingEntries$.description;\n    var timingValue = name;\n\n    if (description) {\n      timingValue += valueSeparator + 'desc=' + description;\n    }\n\n    if (duration) {\n      timingValue += valueSeparator + 'dur=' + duration;\n    }\n\n    serverTimingInfo.push(timingValue);\n  }\n\n  return serverTimingInfo.join(entrySeparator);\n}\n\nfunction getTimeOrigin() {\n  return PERF.timing.fetchStart;\n}\n\nfunction stripQueryStringFromUrl(url) {\n  return url && url.split('?')[0];\n}\n\nfunction isObject(value) {\n  return value !== null && typeof value === 'object';\n}\n\nfunction isFunction(value) {\n  return typeof value === 'function';\n}\n\nfunction baseExtend(dst, objs, deep) {\n  for (var i = 0, ii = objs.length; i < ii; ++i) {\n    var obj = objs[i];\n    if (!isObject(obj) && !isFunction(obj)) continue;\n    var keys = Object.keys(obj);\n\n    for (var j = 0, jj = keys.length; j < jj; j++) {\n      var key = keys[j];\n      var src = obj[key];\n\n      if (deep && isObject(src)) {\n        if (!isObject(dst[key])) dst[key] = Array.isArray(src) ? [] : {};\n        baseExtend(dst[key], [src], false);\n      } else {\n        dst[key] = src;\n      }\n    }\n  }\n\n  return dst;\n}\n\nfunction getElasticScript() {\n  if (typeof document !== 'undefined') {\n    var scripts = document.getElementsByTagName('script');\n\n    for (var i = 0, l = scripts.length; i < l; i++) {\n      var sc = scripts[i];\n\n      if (sc.src.indexOf('elastic') > 0) {\n        return sc;\n      }\n    }\n  }\n}\n\nfunction getCurrentScript() {\n  if (typeof document !== 'undefined') {\n    var currentScript = document.currentScript;\n\n    if (!currentScript) {\n      return getElasticScript();\n    }\n\n    return currentScript;\n  }\n}\n\nfunction extend(dst) {\n  return baseExtend(dst, slice.call(arguments, 1), false);\n}\n\nfunction merge(dst) {\n  return baseExtend(dst, slice.call(arguments, 1), true);\n}\n\nfunction isUndefined(obj) {\n  return typeof obj === 'undefined';\n}\n\nfunction noop() {}\n\nfunction find(array, predicate, thisArg) {\n  if (array == null) {\n    throw new TypeError('array is null or not defined');\n  }\n\n  var o = Object(array);\n  var len = o.length >>> 0;\n\n  if (typeof predicate !== 'function') {\n    throw new TypeError('predicate must be a function');\n  }\n\n  var k = 0;\n\n  while (k < len) {\n    var kValue = o[k];\n\n    if (predicate.call(thisArg, kValue, k, o)) {\n      return kValue;\n    }\n\n    k++;\n  }\n\n  return undefined;\n}\n\nfunction removeInvalidChars(key) {\n  return key.replace(/[.*\"]/g, '_');\n}\n\nfunction getLatestSpan(spans, typeFilter) {\n  var latestSpan = null;\n\n  for (var _i3 = 0; _i3 < spans.length; _i3++) {\n    var span = spans[_i3];\n\n    if (typeFilter && typeFilter(span.type) && (!latestSpan || latestSpan._end < span._end)) {\n      latestSpan = span;\n    }\n  }\n\n  return latestSpan;\n}\n\nfunction getLatestNonXHRSpan(spans) {\n  return getLatestSpan(spans, function (type) {\n    return String(type).indexOf('external') === -1;\n  });\n}\n\nfunction getLatestXHRSpan(spans) {\n  return getLatestSpan(spans, function (type) {\n    return String(type).indexOf('external') !== -1;\n  });\n}\n\nfunction getEarliestSpan(spans) {\n  var earliestSpan = spans[0];\n\n  for (var _i4 = 1; _i4 < spans.length; _i4++) {\n    var span = spans[_i4];\n\n    if (earliestSpan._start > span._start) {\n      earliestSpan = span;\n    }\n  }\n\n  return earliestSpan;\n}\n\nfunction now() {\n  return PERF.now();\n}\n\nfunction getTime(time) {\n  return typeof time === 'number' && time >= 0 ? time : now();\n}\n\nfunction getDuration(start, end) {\n  if (isUndefined(end) || isUndefined(start)) {\n    return null;\n  }\n\n  return parseInt(end - start);\n}\n\nfunction scheduleMacroTask(callback) {\n  setTimeout(callback, 0);\n}\n\nfunction scheduleMicroTask(callback) {\n  Promise.resolve().then(callback);\n}\n\nfunction isPerfTimelineSupported() {\n  return typeof PERF.getEntriesByType === 'function';\n}\n\nfunction isPerfTypeSupported(type) {\n  return typeof PerformanceObserver !== 'undefined' && PerformanceObserver.supportedEntryTypes && PerformanceObserver.supportedEntryTypes.indexOf(type) >= 0;\n}\n\nfunction isBeaconInspectionEnabled() {\n  var flagName = '_elastic_inspect_beacon_';\n\n  if (sessionStorage.getItem(flagName) != null) {\n    return true;\n  }\n\n  if (!window.URL || !window.URLSearchParams) {\n    return false;\n  }\n\n  try {\n    var parsedUrl = new URL(window.location.href);\n    var isFlagSet = parsedUrl.searchParams.has(flagName);\n\n    if (isFlagSet) {\n      sessionStorage.setItem(flagName, true);\n    }\n\n    return isFlagSet;\n  } catch (e) {}\n\n  return false;\n}\n\nexport { extend, merge, isUndefined, noop, baseExtend, bytesToHex, isCORSSupported, isObject, isFunction, isPlatformSupported, isDtHeaderValid, parseDtHeaderValue, getServerTimingInfo, getDtHeaderValue, getTSHeaderValue, getCurrentScript, getElasticScript, getTimeOrigin, generateRandomId, getEarliestSpan, getLatestNonXHRSpan, getLatestXHRSpan, getDuration, getTime, now, rng, checkSameOrigin, scheduleMacroTask, scheduleMicroTask, setLabel, setRequestHeader, stripQueryStringFromUrl, find, removeInvalidChars, PERF, isPerfTimelineSupported, isBrowser, isPerfTypeSupported, isBeaconInspectionEnabled };","export var globalState = {\n  fetchInProgress: false\n};\nexport function apmSymbol(name) {\n  return '__apm_symbol__' + name;\n}\n\nfunction isPropertyWritable(propertyDesc) {\n  if (!propertyDesc) {\n    return true;\n  }\n\n  if (propertyDesc.writable === false) {\n    return false;\n  }\n\n  return !(typeof propertyDesc.get === 'function' && typeof propertyDesc.set === 'undefined');\n}\n\nfunction attachOriginToPatched(patched, original) {\n  patched[apmSymbol('OriginalDelegate')] = original;\n}\n\nexport function patchMethod(target, name, patchFn) {\n  var proto = target;\n\n  while (proto && !proto.hasOwnProperty(name)) {\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  if (!proto && target[name]) {\n    proto = target;\n  }\n\n  var delegateName = apmSymbol(name);\n  var delegate;\n\n  if (proto && !(delegate = proto[delegateName])) {\n    delegate = proto[delegateName] = proto[name];\n    var desc = proto && Object.getOwnPropertyDescriptor(proto, name);\n\n    if (isPropertyWritable(desc)) {\n      var patchDelegate = patchFn(delegate, delegateName, name);\n\n      proto[name] = function () {\n        return patchDelegate(this, arguments);\n      };\n\n      attachOriginToPatched(proto[name], delegate);\n    }\n  }\n\n  return delegate;\n}\nexport var XHR_IGNORE = apmSymbol('xhrIgnore');\nexport var XHR_SYNC = apmSymbol('xhrSync');\nexport var XHR_URL = apmSymbol('xhrURL');\nexport var XHR_METHOD = apmSymbol('xhrMethod');","var SCHEDULE = 'schedule';\nvar INVOKE = 'invoke';\nvar ADD_EVENT_LISTENER_STR = 'addEventListener';\nvar REMOVE_EVENT_LISTENER_STR = 'removeEventListener';\nvar RESOURCE_INITIATOR_TYPES = ['link', 'css', 'script', 'img', 'xmlhttprequest', 'fetch', 'beacon', 'iframe'];\nvar REUSABILITY_THRESHOLD = 5000;\nvar MAX_SPAN_DURATION = 5 * 60 * 1000;\nvar PAGE_LOAD_DELAY = 1000;\nvar PAGE_LOAD = 'page-load';\nvar ROUTE_CHANGE = 'route-change';\nvar TYPE_CUSTOM = 'custom';\nvar USER_INTERACTION = 'user-interaction';\nvar HTTP_REQUEST_TYPE = 'http-request';\nvar TEMPORARY_TYPE = 'temporary';\nvar NAME_UNKNOWN = 'Unknown';\nvar TRANSACTION_TYPE_ORDER = [PAGE_LOAD, ROUTE_CHANGE, USER_INTERACTION, HTTP_REQUEST_TYPE, TYPE_CUSTOM, TEMPORARY_TYPE];\nvar OUTCOME_SUCCESS = 'success';\nvar OUTCOME_FAILURE = 'failure';\nvar OUTCOME_UNKNOWN = 'unknown';\nvar USER_TIMING_THRESHOLD = 60;\nvar TRANSACTION_START = 'transaction:start';\nvar TRANSACTION_END = 'transaction:end';\nvar CONFIG_CHANGE = 'config:change';\nvar QUEUE_FLUSH = 'queue:flush';\nvar QUEUE_ADD_TRANSACTION = 'queue:add_transaction';\nvar XMLHTTPREQUEST = 'xmlhttprequest';\nvar FETCH = 'fetch';\nvar HISTORY = 'history';\nvar EVENT_TARGET = 'eventtarget';\nvar CLICK = 'click';\nvar ERROR = 'error';\nvar BEFORE_EVENT = ':before';\nvar AFTER_EVENT = ':after';\nvar LOCAL_CONFIG_KEY = 'elastic_apm_config';\nvar LONG_TASK = 'longtask';\nvar PAINT = 'paint';\nvar MEASURE = 'measure';\nvar NAVIGATION = 'navigation';\nvar RESOURCE = 'resource';\nvar FIRST_CONTENTFUL_PAINT = 'first-contentful-paint';\nvar LARGEST_CONTENTFUL_PAINT = 'largest-contentful-paint';\nvar FIRST_INPUT = 'first-input';\nvar LAYOUT_SHIFT = 'layout-shift';\nvar ERRORS = 'errors';\nvar TRANSACTIONS = 'transactions';\nvar CONFIG_SERVICE = 'ConfigService';\nvar LOGGING_SERVICE = 'LoggingService';\nvar TRANSACTION_SERVICE = 'TransactionService';\nvar APM_SERVER = 'ApmServer';\nvar PERFORMANCE_MONITORING = 'PerformanceMonitoring';\nvar ERROR_LOGGING = 'ErrorLogging';\nvar TRUNCATED_TYPE = '.truncated';\nvar KEYWORD_LIMIT = 1024;\nvar SESSION_TIMEOUT = 30 * 60000;\nvar HTTP_REQUEST_TIMEOUT = 10000;\nexport { SCHEDULE, INVOKE, ADD_EVENT_LISTENER_STR, REMOVE_EVENT_LISTENER_STR, RESOURCE_INITIATOR_TYPES, REUSABILITY_THRESHOLD, MAX_SPAN_DURATION, PAGE_LOAD_DELAY, PAGE_LOAD, ROUTE_CHANGE, NAME_UNKNOWN, TYPE_CUSTOM, USER_TIMING_THRESHOLD, TRANSACTION_START, TRANSACTION_END, CONFIG_CHANGE, QUEUE_FLUSH, QUEUE_ADD_TRANSACTION, XMLHTTPREQUEST, FETCH, HISTORY, EVENT_TARGET, CLICK, ERROR, BEFORE_EVENT, AFTER_EVENT, LOCAL_CONFIG_KEY, HTTP_REQUEST_TYPE, LONG_TASK, PAINT, MEASURE, NAVIGATION, RESOURCE, FIRST_CONTENTFUL_PAINT, LARGEST_CONTENTFUL_PAINT, KEYWORD_LIMIT, TEMPORARY_TYPE, USER_INTERACTION, TRANSACTION_TYPE_ORDER, ERRORS, TRANSACTIONS, CONFIG_SERVICE, LOGGING_SERVICE, TRANSACTION_SERVICE, APM_SERVER, PERFORMANCE_MONITORING, ERROR_LOGGING, TRUNCATED_TYPE, FIRST_INPUT, LAYOUT_SHIFT, OUTCOME_SUCCESS, OUTCOME_FAILURE, OUTCOME_UNKNOWN, SESSION_TIMEOUT, HTTP_REQUEST_TIMEOUT };","import { patchMethod, XHR_SYNC, XHR_URL, XHR_METHOD, XHR_IGNORE } from './patch-utils';\nimport { SCHEDULE, INVOKE, XMLHTTPREQUEST, ADD_EVENT_LISTENER_STR } from '../constants';\nexport function patchXMLHttpRequest(callback) {\n  var XMLHttpRequestPrototype = XMLHttpRequest.prototype;\n\n  if (!XMLHttpRequestPrototype || !XMLHttpRequestPrototype[ADD_EVENT_LISTENER_STR]) {\n    return;\n  }\n\n  var READY_STATE_CHANGE = 'readystatechange';\n  var LOAD = 'load';\n  var ERROR = 'error';\n  var TIMEOUT = 'timeout';\n  var ABORT = 'abort';\n\n  function invokeTask(task, status) {\n    if (task.state !== INVOKE) {\n      task.state = INVOKE;\n      task.data.status = status;\n      callback(INVOKE, task);\n    }\n  }\n\n  function scheduleTask(task) {\n    if (task.state === SCHEDULE) {\n      return;\n    }\n\n    task.state = SCHEDULE;\n    callback(SCHEDULE, task);\n    var target = task.data.target;\n\n    function addListener(name) {\n      target[ADD_EVENT_LISTENER_STR](name, function (_ref) {\n        var type = _ref.type;\n\n        if (type === READY_STATE_CHANGE) {\n          if (target.readyState === 4 && target.status !== 0) {\n            invokeTask(task, 'success');\n          }\n        } else {\n          var status = type === LOAD ? 'success' : type;\n          invokeTask(task, status);\n        }\n      });\n    }\n\n    addListener(READY_STATE_CHANGE);\n    addListener(LOAD);\n    addListener(TIMEOUT);\n    addListener(ERROR);\n    addListener(ABORT);\n  }\n\n  var openNative = patchMethod(XMLHttpRequestPrototype, 'open', function () {\n    return function (self, args) {\n      if (!self[XHR_IGNORE]) {\n        self[XHR_METHOD] = args[0];\n        self[XHR_URL] = args[1];\n        self[XHR_SYNC] = args[2] === false;\n      }\n\n      return openNative.apply(self, args);\n    };\n  });\n  var sendNative = patchMethod(XMLHttpRequestPrototype, 'send', function () {\n    return function (self, args) {\n      if (self[XHR_IGNORE]) {\n        return sendNative.apply(self, args);\n      }\n\n      var task = {\n        source: XMLHTTPREQUEST,\n        state: '',\n        type: 'macroTask',\n        data: {\n          target: self,\n          method: self[XHR_METHOD],\n          sync: self[XHR_SYNC],\n          url: self[XHR_URL],\n          status: ''\n        }\n      };\n\n      try {\n        scheduleTask(task);\n        return sendNative.apply(self, args);\n      } catch (e) {\n        invokeTask(task, ERROR);\n        throw e;\n      }\n    };\n  });\n}","export function isResponseSuccessful(status) {\n  if (status === 0 || status > 399 && status < 600) {\n    return false;\n  }\n\n  return true;\n}","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport { HTTP_REQUEST_TIMEOUT } from '../constants';\nimport { isResponseSuccessful } from './response-status';\nexport var BYTE_LIMIT = 60 * 1000;\nexport function shouldUseFetchWithKeepAlive(method, payload) {\n  if (!isFetchSupported()) {\n    return false;\n  }\n\n  var isKeepAliveSupported = ('keepalive' in new Request(''));\n\n  if (!isKeepAliveSupported) {\n    return false;\n  }\n\n  var size = calculateSize(payload);\n  return method === 'POST' && size < BYTE_LIMIT;\n}\nexport function sendFetchRequest(method, url, _ref) {\n  var _ref$keepalive = _ref.keepalive,\n      keepalive = _ref$keepalive === void 0 ? false : _ref$keepalive,\n      _ref$timeout = _ref.timeout,\n      timeout = _ref$timeout === void 0 ? HTTP_REQUEST_TIMEOUT : _ref$timeout,\n      payload = _ref.payload,\n      headers = _ref.headers,\n      sendCredentials = _ref.sendCredentials;\n  var timeoutConfig = {};\n\n  if (typeof AbortController === 'function') {\n    var controller = new AbortController();\n    timeoutConfig.signal = controller.signal;\n    setTimeout(function () {\n      return controller.abort();\n    }, timeout);\n  }\n\n  var fetchResponse;\n  return window.fetch(url, _extends({\n    body: payload,\n    headers: headers,\n    method: method,\n    keepalive: keepalive,\n    credentials: sendCredentials ? 'include' : 'omit'\n  }, timeoutConfig)).then(function (response) {\n    fetchResponse = response;\n    return fetchResponse.text();\n  }).then(function (responseText) {\n    var bodyResponse = {\n      url: url,\n      status: fetchResponse.status,\n      responseText: responseText\n    };\n\n    if (!isResponseSuccessful(fetchResponse.status)) {\n      throw bodyResponse;\n    }\n\n    return bodyResponse;\n  });\n}\nexport function isFetchSupported() {\n  return typeof window.fetch === 'function' && typeof window.Request === 'function';\n}\n\nfunction calculateSize(payload) {\n  if (!payload) {\n    return 0;\n  }\n\n  if (payload instanceof Blob) {\n    return payload.size;\n  }\n\n  return new Blob([payload]).size;\n}","import { BEFORE_EVENT, AFTER_EVENT } from './constants';\n\nvar EventHandler = function () {\n  function EventHandler() {\n    this.observers = {};\n  }\n\n  var _proto = EventHandler.prototype;\n\n  _proto.observe = function observe(name, fn) {\n    var _this = this;\n\n    if (typeof fn === 'function') {\n      if (!this.observers[name]) {\n        this.observers[name] = [];\n      }\n\n      this.observers[name].push(fn);\n      return function () {\n        var index = _this.observers[name].indexOf(fn);\n\n        if (index > -1) {\n          _this.observers[name].splice(index, 1);\n        }\n      };\n    }\n  };\n\n  _proto.sendOnly = function sendOnly(name, args) {\n    var obs = this.observers[name];\n\n    if (obs) {\n      obs.forEach(function (fn) {\n        try {\n          fn.apply(undefined, args);\n        } catch (error) {\n          console.log(error, error.stack);\n        }\n      });\n    }\n  };\n\n  _proto.send = function send(name, args) {\n    this.sendOnly(name + BEFORE_EVENT, args);\n    this.sendOnly(name, args);\n    this.sendOnly(name + AFTER_EVENT, args);\n  };\n\n  return EventHandler;\n}();\n\nexport default EventHandler;","import { patchXMLHttpRequest } from './xhr-patch';\nimport { patchFetch } from './fetch-patch';\nimport { patchHistory } from './history-patch';\nimport EventHandler from '../event-handler';\nimport { HISTORY, FETCH, XMLHTTPREQUEST } from '../constants';\nvar patchEventHandler = new EventHandler();\nvar alreadyPatched = false;\n\nfunction patchAll() {\n  if (!alreadyPatched) {\n    alreadyPatched = true;\n    patchXMLHttpRequest(function (event, task) {\n      patchEventHandler.send(XMLHTTPREQUEST, [event, task]);\n    });\n    patchFetch(function (event, task) {\n      patchEventHandler.send(FETCH, [event, task]);\n    });\n    patchHistory(function (event, task) {\n      patchEventHandler.send(HISTORY, [event, task]);\n    });\n  }\n\n  return patchEventHandler;\n}\n\nexport { patchAll, patchEventHandler };","import { Promise } from '../polyfills';\nimport { globalState } from './patch-utils';\nimport { SCHEDULE, INVOKE, FETCH } from '../constants';\nimport { scheduleMicroTask } from '../utils';\nimport { isFetchSupported } from '../http/fetch';\nexport function patchFetch(callback) {\n  if (!isFetchSupported()) {\n    return;\n  }\n\n  function scheduleTask(task) {\n    task.state = SCHEDULE;\n    callback(SCHEDULE, task);\n  }\n\n  function invokeTask(task) {\n    task.state = INVOKE;\n    callback(INVOKE, task);\n  }\n\n  function handleResponseError(task, error) {\n    task.data.aborted = isAbortError(error);\n    task.data.error = error;\n    invokeTask(task);\n  }\n\n  function readStream(stream, task) {\n    var reader = stream.getReader();\n\n    var read = function read() {\n      reader.read().then(function (_ref) {\n        var done = _ref.done;\n\n        if (done) {\n          invokeTask(task);\n        } else {\n          read();\n        }\n      }, function (error) {\n        handleResponseError(task, error);\n      });\n    };\n\n    read();\n  }\n\n  var nativeFetch = window.fetch;\n\n  window.fetch = function (input, init) {\n    var fetchSelf = this;\n    var args = arguments;\n    var request, url;\n\n    if (typeof input === 'string') {\n      request = new Request(input, init);\n      url = input;\n    } else if (input) {\n      request = input;\n      url = request.url;\n    } else {\n      return nativeFetch.apply(fetchSelf, args);\n    }\n\n    var task = {\n      source: FETCH,\n      state: '',\n      type: 'macroTask',\n      data: {\n        target: request,\n        method: request.method,\n        url: url,\n        aborted: false\n      }\n    };\n    return new Promise(function (resolve, reject) {\n      globalState.fetchInProgress = true;\n      scheduleTask(task);\n      var promise;\n\n      try {\n        promise = nativeFetch.apply(fetchSelf, [request]);\n      } catch (error) {\n        reject(error);\n        task.data.error = error;\n        invokeTask(task);\n        globalState.fetchInProgress = false;\n        return;\n      }\n\n      promise.then(function (response) {\n        var clonedResponse = response.clone ? response.clone() : {};\n        resolve(response);\n        scheduleMicroTask(function () {\n          task.data.response = response;\n          var body = clonedResponse.body;\n\n          if (body) {\n            readStream(body, task);\n          } else {\n            invokeTask(task);\n          }\n        });\n      }, function (error) {\n        reject(error);\n        scheduleMicroTask(function () {\n          handleResponseError(task, error);\n        });\n      });\n      globalState.fetchInProgress = false;\n    });\n  };\n}\n\nfunction isAbortError(error) {\n  return error && error.name === 'AbortError';\n}","import { INVOKE, HISTORY } from '../constants';\nexport function patchHistory(callback) {\n  if (!window.history) {\n    return;\n  }\n\n  var nativePushState = history.pushState;\n\n  if (typeof nativePushState === 'function') {\n    history.pushState = function (state, title, url) {\n      var task = {\n        source: HISTORY,\n        data: {\n          state: state,\n          title: title,\n          url: url\n        }\n      };\n      callback(INVOKE, task);\n      nativePushState.apply(this, arguments);\n    };\n  }\n}","var __DEV__ = process.env.NODE_ENV !== 'production';\n\nvar state = {\n  bootstrapTime: null,\n  lastHiddenStart: Number.MIN_SAFE_INTEGER\n};\nexport { __DEV__, state };","import { isPlatformSupported, isBrowser, now } from './common/utils';\nimport { patchAll } from './common/patching';\nimport { state } from './state';\nvar enabled = false;\nexport function bootstrap() {\n  if (isPlatformSupported()) {\n    patchAll();\n    state.bootstrapTime = now();\n    enabled = true;\n  } else if (isBrowser) {\n    console.log('[Elastic APM] platform is not supported!');\n  }\n\n  return enabled;\n}","function filePathToFileName(fileUrl) {\n  var origin = window.location.origin || window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n\n  if (fileUrl.indexOf(origin) > -1) {\n    fileUrl = fileUrl.replace(origin + '/', '');\n  }\n\n  return fileUrl;\n}\n\nfunction cleanFilePath(filePath) {\n  if (filePath === void 0) {\n    filePath = '';\n  }\n\n  if (filePath === '<anonymous>') {\n    filePath = '';\n  }\n\n  return filePath;\n}\n\nfunction isFileInline(fileUrl) {\n  if (fileUrl) {\n    return window.location.href.indexOf(fileUrl) === 0;\n  }\n\n  return false;\n}\n\nfunction normalizeStackFrames(stackFrames) {\n  return stackFrames.map(function (frame) {\n    if (frame.functionName) {\n      frame.functionName = normalizeFunctionName(frame.functionName);\n    }\n\n    return frame;\n  });\n}\n\nfunction normalizeFunctionName(fnName) {\n  var parts = fnName.split('/');\n\n  if (parts.length > 1) {\n    fnName = ['Object', parts[parts.length - 1]].join('.');\n  } else {\n    fnName = parts[0];\n  }\n\n  fnName = fnName.replace(/.<$/gi, '.<anonymous>');\n  fnName = fnName.replace(/^Anonymous function$/, '<anonymous>');\n  parts = fnName.split('.');\n\n  if (parts.length > 1) {\n    fnName = parts[parts.length - 1];\n  } else {\n    fnName = parts[0];\n  }\n\n  return fnName;\n}\n\nfunction isValidStackTrace(stackTraces) {\n  if (stackTraces.length === 0) {\n    return false;\n  }\n\n  if (stackTraces.length === 1) {\n    var stackTrace = stackTraces[0];\n    return 'lineNumber' in stackTrace;\n  }\n\n  return true;\n}\n\nexport function createStackTraces(stackParser, errorEvent) {\n  var error = errorEvent.error,\n      filename = errorEvent.filename,\n      lineno = errorEvent.lineno,\n      colno = errorEvent.colno;\n  var stackTraces = [];\n\n  if (error) {\n    try {\n      stackTraces = stackParser.parse(error);\n    } catch (e) {}\n  }\n\n  if (!isValidStackTrace(stackTraces)) {\n    stackTraces = [{\n      fileName: filename,\n      lineNumber: lineno,\n      columnNumber: colno\n    }];\n  }\n\n  var normalizedStackTraces = normalizeStackFrames(stackTraces);\n  return normalizedStackTraces.map(function (stack) {\n    var fileName = stack.fileName,\n        lineNumber = stack.lineNumber,\n        columnNumber = stack.columnNumber,\n        _stack$functionName = stack.functionName,\n        functionName = _stack$functionName === void 0 ? '<anonymous>' : _stack$functionName;\n\n    if (!fileName && !lineNumber) {\n      return {};\n    }\n\n    if (!columnNumber && !lineNumber) {\n      return {};\n    }\n\n    var filePath = cleanFilePath(fileName);\n    var cleanedFileName = filePathToFileName(filePath);\n\n    if (isFileInline(filePath)) {\n      cleanedFileName = '(inline script)';\n    }\n\n    return {\n      abs_path: fileName,\n      filename: cleanedFileName,\n      function: functionName,\n      lineno: lineNumber,\n      colno: columnNumber\n    };\n  });\n}\nexport function filterInvalidFrames(frames) {\n  return frames.filter(function (_ref) {\n    var filename = _ref.filename,\n        lineno = _ref.lineno;\n    return typeof filename !== 'undefined' && typeof lineno !== 'undefined';\n  });\n}","import { isBrowser } from './utils';\n\nfunction isDefaultPort(port, protocol) {\n  switch (protocol) {\n    case 'http:':\n      return port === '80';\n\n    case 'https:':\n      return port === '443';\n  }\n\n  return true;\n}\n\nvar RULES = [['#', 'hash'], ['?', 'query'], ['/', 'path'], ['@', 'auth', 1], [NaN, 'host', undefined, 1]];\nvar PROTOCOL_REGEX = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\S\\s]*)/i;\nexport var Url = function () {\n  function Url(url) {\n    var _this$extractProtocol = this.extractProtocol(url || ''),\n        protocol = _this$extractProtocol.protocol,\n        address = _this$extractProtocol.address,\n        slashes = _this$extractProtocol.slashes;\n\n    var relative = !protocol && !slashes;\n    var location = this.getLocation();\n    var instructions = RULES.slice();\n    address = address.replace('\\\\', '/');\n\n    if (!slashes) {\n      instructions[2] = [NaN, 'path'];\n    }\n\n    var index;\n\n    for (var i = 0; i < instructions.length; i++) {\n      var instruction = instructions[i];\n      var parse = instruction[0];\n      var key = instruction[1];\n\n      if (typeof parse === 'string') {\n        index = address.indexOf(parse);\n\n        if (~index) {\n          var instLength = instruction[2];\n\n          if (instLength) {\n            var newIndex = address.lastIndexOf(parse);\n            index = Math.max(index, newIndex);\n            this[key] = address.slice(0, index);\n            address = address.slice(index + instLength);\n          } else {\n            this[key] = address.slice(index);\n            address = address.slice(0, index);\n          }\n        }\n      } else {\n        this[key] = address;\n        address = '';\n      }\n\n      this[key] = this[key] || (relative && instruction[3] ? location[key] || '' : '');\n      if (instruction[3]) this[key] = this[key].toLowerCase();\n    }\n\n    if (relative && this.path.charAt(0) !== '/') {\n      this.path = '/' + this.path;\n    }\n\n    this.relative = relative;\n    this.protocol = protocol || location.protocol;\n    this.hostname = this.host;\n    this.port = '';\n\n    if (/:\\d+$/.test(this.host)) {\n      var value = this.host.split(':');\n      var port = value.pop();\n      var hostname = value.join(':');\n\n      if (isDefaultPort(port, this.protocol)) {\n        this.host = hostname;\n      } else {\n        this.port = port;\n      }\n\n      this.hostname = hostname;\n    }\n\n    this.origin = this.protocol && this.host && this.protocol !== 'file:' ? this.protocol + '//' + this.host : 'null';\n    this.href = this.toString();\n  }\n\n  var _proto = Url.prototype;\n\n  _proto.toString = function toString() {\n    var result = this.protocol;\n    result += '//';\n\n    if (this.auth) {\n      var REDACTED = '[REDACTED]';\n      var userpass = this.auth.split(':');\n      var username = userpass[0] ? REDACTED : '';\n      var password = userpass[1] ? ':' + REDACTED : '';\n      result += username + password + '@';\n    }\n\n    result += this.host;\n    result += this.path;\n    result += this.query;\n    result += this.hash;\n    return result;\n  };\n\n  _proto.getLocation = function getLocation() {\n    var globalVar = {};\n\n    if (isBrowser) {\n      globalVar = window;\n    }\n\n    return globalVar.location;\n  };\n\n  _proto.extractProtocol = function extractProtocol(url) {\n    var match = PROTOCOL_REGEX.exec(url);\n    return {\n      protocol: match[1] ? match[1].toLowerCase() : '',\n      slashes: !!match[2],\n      address: match[3]\n    };\n  };\n\n  return Url;\n}();\nexport function slugifyUrl(urlStr, depth) {\n  if (depth === void 0) {\n    depth = 2;\n  }\n\n  var parsedUrl = new Url(urlStr);\n  var query = parsedUrl.query,\n      path = parsedUrl.path;\n  var pathParts = path.substring(1).split('/');\n  var redactString = ':id';\n  var wildcard = '*';\n  var specialCharsRegex = /\\W|_/g;\n  var digitsRegex = /[0-9]/g;\n  var lowerCaseRegex = /[a-z]/g;\n  var upperCaseRegex = /[A-Z]/g;\n  var redactedParts = [];\n  var redactedBefore = false;\n\n  for (var index = 0; index < pathParts.length; index++) {\n    var part = pathParts[index];\n\n    if (redactedBefore || index > depth - 1) {\n      if (part) {\n        redactedParts.push(wildcard);\n      }\n\n      break;\n    }\n\n    var numberOfSpecialChars = (part.match(specialCharsRegex) || []).length;\n\n    if (numberOfSpecialChars >= 2) {\n      redactedParts.push(redactString);\n      redactedBefore = true;\n      continue;\n    }\n\n    var numberOfDigits = (part.match(digitsRegex) || []).length;\n\n    if (numberOfDigits > 3 || part.length > 3 && numberOfDigits / part.length >= 0.3) {\n      redactedParts.push(redactString);\n      redactedBefore = true;\n      continue;\n    }\n\n    var numberofUpperCase = (part.match(upperCaseRegex) || []).length;\n    var numberofLowerCase = (part.match(lowerCaseRegex) || []).length;\n    var lowerCaseRate = numberofLowerCase / part.length;\n    var upperCaseRate = numberofUpperCase / part.length;\n\n    if (part.length > 5 && (upperCaseRate > 0.3 && upperCaseRate < 0.6 || lowerCaseRate > 0.3 && lowerCaseRate < 0.6)) {\n      redactedParts.push(redactString);\n      redactedBefore = true;\n      continue;\n    }\n\n    part && redactedParts.push(part);\n  }\n\n  var redacted = '/' + (redactedParts.length >= 2 ? redactedParts.join('/') : redactedParts.join('')) + (query ? '?{query}' : '');\n  return redacted;\n}","var _excluded = [\"tags\"];\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { Url } from './url';\nimport { PAGE_LOAD, NAVIGATION } from './constants';\nimport { getServerTimingInfo, PERF, isPerfTimelineSupported } from './utils';\nvar LEFT_SQUARE_BRACKET = 91;\nvar RIGHT_SQUARE_BRACKET = 93;\nvar EXTERNAL = 'external';\nvar RESOURCE = 'resource';\nvar HARD_NAVIGATION = 'hard-navigation';\n\nfunction getPortNumber(port, protocol) {\n  if (port === '') {\n    port = protocol === 'http:' ? '80' : protocol === 'https:' ? '443' : '';\n  }\n\n  return port;\n}\n\nfunction getResponseContext(perfTimingEntry) {\n  var transferSize = perfTimingEntry.transferSize,\n      encodedBodySize = perfTimingEntry.encodedBodySize,\n      decodedBodySize = perfTimingEntry.decodedBodySize,\n      serverTiming = perfTimingEntry.serverTiming;\n  var respContext = {\n    transfer_size: transferSize,\n    encoded_body_size: encodedBodySize,\n    decoded_body_size: decodedBodySize\n  };\n  var serverTimingStr = getServerTimingInfo(serverTiming);\n\n  if (serverTimingStr) {\n    respContext.headers = {\n      'server-timing': serverTimingStr\n    };\n  }\n\n  return respContext;\n}\n\nfunction getDestination(parsedUrl) {\n  var port = parsedUrl.port,\n      protocol = parsedUrl.protocol,\n      hostname = parsedUrl.hostname;\n  var portNumber = getPortNumber(port, protocol);\n  var ipv6Hostname = hostname.charCodeAt(0) === LEFT_SQUARE_BRACKET && hostname.charCodeAt(hostname.length - 1) === RIGHT_SQUARE_BRACKET;\n  var address = hostname;\n\n  if (ipv6Hostname) {\n    address = hostname.slice(1, -1);\n  }\n\n  return {\n    service: {\n      resource: hostname + ':' + portNumber,\n      name: '',\n      type: ''\n    },\n    address: address,\n    port: Number(portNumber)\n  };\n}\n\nfunction getResourceContext(data) {\n  var entry = data.entry,\n      url = data.url;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl);\n  return {\n    http: {\n      url: url,\n      response: getResponseContext(entry)\n    },\n    destination: destination\n  };\n}\n\nfunction getExternalContext(data) {\n  var url = data.url,\n      method = data.method,\n      target = data.target,\n      response = data.response;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl);\n  var context = {\n    http: {\n      method: method,\n      url: parsedUrl.href\n    },\n    destination: destination\n  };\n  var statusCode;\n\n  if (target && typeof target.status !== 'undefined') {\n    statusCode = target.status;\n  } else if (response) {\n    statusCode = response.status;\n  }\n\n  context.http.status_code = statusCode;\n  return context;\n}\n\nfunction getNavigationContext(data) {\n  var url = data.url;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl);\n  return {\n    destination: destination\n  };\n}\n\nexport function getPageContext() {\n  return {\n    page: {\n      referer: document.referrer,\n      url: location.href\n    }\n  };\n}\nexport function addSpanContext(span, data) {\n  if (!data) {\n    return;\n  }\n\n  var type = span.type;\n  var context;\n\n  switch (type) {\n    case EXTERNAL:\n      context = getExternalContext(data);\n      break;\n\n    case RESOURCE:\n      context = getResourceContext(data);\n      break;\n\n    case HARD_NAVIGATION:\n      context = getNavigationContext(data);\n      break;\n  }\n\n  span.addContext(context);\n}\nexport function addTransactionContext(transaction, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      tags = _ref.tags,\n      configContext = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  var pageContext = getPageContext();\n  var responseContext = {};\n\n  if (transaction.type === PAGE_LOAD && isPerfTimelineSupported()) {\n    var entries = PERF.getEntriesByType(NAVIGATION);\n\n    if (entries && entries.length > 0) {\n      responseContext = {\n        response: getResponseContext(entries[0])\n      };\n    }\n  }\n\n  transaction.addContext(pageContext, responseContext, configContext);\n}","import { KEYWORD_LIMIT } from './constants';\nvar METADATA_MODEL = {\n  service: {\n    name: [KEYWORD_LIMIT, true],\n    version: true,\n    agent: {\n      version: [KEYWORD_LIMIT, true]\n    },\n    environment: true\n  },\n  labels: {\n    '*': true\n  }\n};\nvar RESPONSE_MODEL = {\n  '*': true,\n  headers: {\n    '*': true\n  }\n};\nvar DESTINATION_MODEL = {\n  address: [KEYWORD_LIMIT],\n  service: {\n    '*': [KEYWORD_LIMIT, true]\n  }\n};\nvar CONTEXT_MODEL = {\n  user: {\n    id: true,\n    email: true,\n    username: true\n  },\n  tags: {\n    '*': true\n  },\n  http: {\n    response: RESPONSE_MODEL\n  },\n  destination: DESTINATION_MODEL,\n  response: RESPONSE_MODEL\n};\nvar SPAN_MODEL = {\n  name: [KEYWORD_LIMIT, true],\n  type: [KEYWORD_LIMIT, true],\n  id: [KEYWORD_LIMIT, true],\n  trace_id: [KEYWORD_LIMIT, true],\n  parent_id: [KEYWORD_LIMIT, true],\n  transaction_id: [KEYWORD_LIMIT, true],\n  subtype: true,\n  action: true,\n  context: CONTEXT_MODEL\n};\nvar TRANSACTION_MODEL = {\n  name: true,\n  parent_id: true,\n  type: [KEYWORD_LIMIT, true],\n  id: [KEYWORD_LIMIT, true],\n  trace_id: [KEYWORD_LIMIT, true],\n  span_count: {\n    started: [KEYWORD_LIMIT, true]\n  },\n  context: CONTEXT_MODEL\n};\nvar ERROR_MODEL = {\n  id: [KEYWORD_LIMIT, true],\n  trace_id: true,\n  transaction_id: true,\n  parent_id: true,\n  culprit: true,\n  exception: {\n    type: true\n  },\n  transaction: {\n    type: true\n  },\n  context: CONTEXT_MODEL\n};\n\nfunction truncate(value, limit, required, placeholder) {\n  if (limit === void 0) {\n    limit = KEYWORD_LIMIT;\n  }\n\n  if (required === void 0) {\n    required = false;\n  }\n\n  if (placeholder === void 0) {\n    placeholder = 'N/A';\n  }\n\n  if (required && isEmpty(value)) {\n    value = placeholder;\n  }\n\n  if (typeof value === 'string') {\n    return value.substring(0, limit);\n  }\n\n  return value;\n}\n\nfunction isEmpty(value) {\n  return value == null || value === '' || typeof value === 'undefined';\n}\n\nfunction replaceValue(target, key, currModel) {\n  var value = truncate(target[key], currModel[0], currModel[1]);\n\n  if (isEmpty(value)) {\n    delete target[key];\n    return;\n  }\n\n  target[key] = value;\n}\n\nfunction truncateModel(model, target, childTarget) {\n  if (model === void 0) {\n    model = {};\n  }\n\n  if (childTarget === void 0) {\n    childTarget = target;\n  }\n\n  var keys = Object.keys(model);\n  var emptyArr = [];\n\n  var _loop = function _loop(i) {\n    var currKey = keys[i];\n    var currModel = model[currKey] === true ? emptyArr : model[currKey];\n\n    if (!Array.isArray(currModel)) {\n      truncateModel(currModel, target, childTarget[currKey]);\n    } else {\n      if (currKey === '*') {\n        Object.keys(childTarget).forEach(function (key) {\n          return replaceValue(childTarget, key, currModel);\n        });\n      } else {\n        replaceValue(childTarget, currKey, currModel);\n      }\n    }\n  };\n\n  for (var i = 0; i < keys.length; i++) {\n    _loop(i);\n  }\n\n  return target;\n}\n\nexport { truncate, truncateModel, SPAN_MODEL, TRANSACTION_MODEL, ERROR_MODEL, METADATA_MODEL, RESPONSE_MODEL };","var _excluded = [\"tags\"];\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { createStackTraces, filterInvalidFrames } from './stack-trace';\nimport { generateRandomId, merge, extend } from '../common/utils';\nimport { getPageContext } from '../common/context';\nimport { truncateModel, ERROR_MODEL } from '../common/truncate';\nimport stackParser from 'error-stack-parser';\nvar IGNORE_KEYS = ['stack', 'message'];\n\nfunction getErrorProperties(error) {\n  var propertyFound = false;\n  var properties = {};\n  Object.keys(error).forEach(function (key) {\n    if (IGNORE_KEYS.indexOf(key) >= 0) {\n      return;\n    }\n\n    var val = error[key];\n\n    if (val == null || typeof val === 'function') {\n      return;\n    }\n\n    if (typeof val === 'object') {\n      if (typeof val.toISOString !== 'function') return;\n      val = val.toISOString();\n    }\n\n    properties[key] = val;\n    propertyFound = true;\n  });\n\n  if (propertyFound) {\n    return properties;\n  }\n}\n\nvar ErrorLogging = function () {\n  function ErrorLogging(apmServer, configService, transactionService) {\n    this._apmServer = apmServer;\n    this._configService = configService;\n    this._transactionService = transactionService;\n  }\n\n  var _proto = ErrorLogging.prototype;\n\n  _proto.createErrorDataModel = function createErrorDataModel(errorEvent) {\n    var frames = createStackTraces(stackParser, errorEvent);\n    var filteredFrames = filterInvalidFrames(frames);\n    var culprit = '(inline script)';\n    var lastFrame = filteredFrames[filteredFrames.length - 1];\n\n    if (lastFrame && lastFrame.filename) {\n      culprit = lastFrame.filename;\n    }\n\n    var message = errorEvent.message,\n        error = errorEvent.error;\n    var errorMessage = message;\n    var errorType = '';\n    var errorContext = {};\n\n    if (error && typeof error === 'object') {\n      errorMessage = errorMessage || error.message;\n      errorType = error.name;\n      var customProperties = getErrorProperties(error);\n\n      if (customProperties) {\n        errorContext.custom = customProperties;\n      }\n    }\n\n    if (!errorType) {\n      if (errorMessage && errorMessage.indexOf(':') > -1) {\n        errorType = errorMessage.split(':')[0];\n      }\n    }\n\n    var currentTransaction = this._transactionService.getCurrentTransaction();\n\n    var transactionContext = currentTransaction ? currentTransaction.context : {};\n\n    var _this$_configService$ = this._configService.get('context'),\n        tags = _this$_configService$.tags,\n        configContext = _objectWithoutPropertiesLoose(_this$_configService$, _excluded);\n\n    var pageContext = getPageContext();\n    var context = merge({}, pageContext, transactionContext, configContext, errorContext);\n    var errorObject = {\n      id: generateRandomId(),\n      culprit: culprit,\n      exception: {\n        message: errorMessage,\n        stacktrace: filteredFrames,\n        type: errorType\n      },\n      context: context\n    };\n\n    if (currentTransaction) {\n      errorObject = extend(errorObject, {\n        trace_id: currentTransaction.traceId,\n        parent_id: currentTransaction.id,\n        transaction_id: currentTransaction.id,\n        transaction: {\n          type: currentTransaction.type,\n          sampled: currentTransaction.sampled\n        }\n      });\n    }\n\n    return truncateModel(ERROR_MODEL, errorObject);\n  };\n\n  _proto.logErrorEvent = function logErrorEvent(errorEvent) {\n    if (typeof errorEvent === 'undefined') {\n      return;\n    }\n\n    var errorObject = this.createErrorDataModel(errorEvent);\n\n    if (typeof errorObject.exception.message === 'undefined') {\n      return;\n    }\n\n    this._apmServer.addError(errorObject);\n  };\n\n  _proto.registerListeners = function registerListeners() {\n    var _this = this;\n\n    window.addEventListener('error', function (errorEvent) {\n      return _this.logErrorEvent(errorEvent);\n    });\n    window.addEventListener('unhandledrejection', function (promiseRejectionEvent) {\n      return _this.logPromiseEvent(promiseRejectionEvent);\n    });\n  };\n\n  _proto.logPromiseEvent = function logPromiseEvent(promiseRejectionEvent) {\n    var prefix = 'Unhandled promise rejection: ';\n    var reason = promiseRejectionEvent.reason;\n\n    if (reason == null) {\n      reason = '<no reason specified>';\n    }\n\n    var errorEvent;\n\n    if (typeof reason.message === 'string') {\n      var name = reason.name ? reason.name + ': ' : '';\n      errorEvent = {\n        error: reason,\n        message: prefix + name + reason.message\n      };\n    } else {\n      reason = typeof reason === 'object' ? '<object>' : typeof reason === 'function' ? '<function>' : reason;\n      errorEvent = {\n        message: prefix + reason\n      };\n    }\n\n    this.logErrorEvent(errorEvent);\n  };\n\n  _proto.logError = function logError(messageOrError) {\n    var errorEvent = {};\n\n    if (typeof messageOrError === 'string') {\n      errorEvent.message = messageOrError;\n    } else {\n      errorEvent.error = messageOrError;\n    }\n\n    return this.logErrorEvent(errorEvent);\n  };\n\n  return ErrorLogging;\n}();\n\nexport default ErrorLogging;","var Queue = function () {\n  function Queue(onFlush, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n\n    this.onFlush = onFlush;\n    this.items = [];\n    this.queueLimit = opts.queueLimit || -1;\n    this.flushInterval = opts.flushInterval || 0;\n    this.timeoutId = undefined;\n  }\n\n  var _proto = Queue.prototype;\n\n  _proto._setTimer = function _setTimer() {\n    var _this = this;\n\n    this.timeoutId = setTimeout(function () {\n      return _this.flush();\n    }, this.flushInterval);\n  };\n\n  _proto._clear = function _clear() {\n    if (typeof this.timeoutId !== 'undefined') {\n      clearTimeout(this.timeoutId);\n      this.timeoutId = undefined;\n    }\n\n    this.items = [];\n  };\n\n  _proto.flush = function flush() {\n    this.onFlush(this.items);\n\n    this._clear();\n  };\n\n  _proto.add = function add(item) {\n    this.items.push(item);\n\n    if (this.queueLimit !== -1 && this.items.length >= this.queueLimit) {\n      this.flush();\n    } else {\n      if (typeof this.timeoutId === 'undefined') {\n        this._setTimer();\n      }\n    }\n  };\n\n  return Queue;\n}();\n\nexport default Queue;","var NDJSON = function () {\n  function NDJSON() {}\n\n  NDJSON.stringify = function stringify(object) {\n    return JSON.stringify(object) + '\\n';\n  };\n\n  return NDJSON;\n}();\n\nexport default NDJSON;","import { generateRandomId, setLabel, merge, getDuration, getTime } from '../common/utils';\nimport { NAME_UNKNOWN, TYPE_CUSTOM } from '../common/constants';\n\nvar SpanBase = function () {\n  function SpanBase(name, type, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    if (!name) {\n      name = NAME_UNKNOWN;\n    }\n\n    if (!type) {\n      type = TYPE_CUSTOM;\n    }\n\n    this.name = name;\n    this.type = type;\n    this.options = options;\n    this.id = options.id || generateRandomId(16);\n    this.traceId = options.traceId;\n    this.sampled = options.sampled;\n    this.sampleRate = options.sampleRate;\n    this.timestamp = options.timestamp;\n    this._start = getTime(options.startTime);\n    this._end = undefined;\n    this.ended = false;\n    this.outcome = undefined;\n    this.onEnd = options.onEnd;\n  }\n\n  var _proto = SpanBase.prototype;\n\n  _proto.ensureContext = function ensureContext() {\n    if (!this.context) {\n      this.context = {};\n    }\n  };\n\n  _proto.addLabels = function addLabels(tags) {\n    this.ensureContext();\n    var ctx = this.context;\n\n    if (!ctx.tags) {\n      ctx.tags = {};\n    }\n\n    var keys = Object.keys(tags);\n    keys.forEach(function (k) {\n      return setLabel(k, tags[k], ctx.tags);\n    });\n  };\n\n  _proto.addContext = function addContext() {\n    for (var _len = arguments.length, context = new Array(_len), _key = 0; _key < _len; _key++) {\n      context[_key] = arguments[_key];\n    }\n\n    if (context.length === 0) return;\n    this.ensureContext();\n    merge.apply(void 0, [this.context].concat(context));\n  };\n\n  _proto.end = function end(endTime) {\n    if (this.ended) {\n      return;\n    }\n\n    this.ended = true;\n    this._end = getTime(endTime);\n    this.callOnEnd();\n  };\n\n  _proto.callOnEnd = function callOnEnd() {\n    if (typeof this.onEnd === 'function') {\n      this.onEnd(this);\n    }\n  };\n\n  _proto.duration = function duration() {\n    return getDuration(this._start, this._end);\n  };\n\n  return SpanBase;\n}();\n\nexport default SpanBase;","function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport SpanBase from './span-base';\nimport { addSpanContext } from '../common/context';\n\nvar Span = function (_SpanBase) {\n  _inheritsLoose(Span, _SpanBase);\n\n  function Span(name, type, options) {\n    var _this;\n\n    _this = _SpanBase.call(this, name, type, options) || this;\n    _this.parentId = _this.options.parentId;\n    _this.subtype = undefined;\n    _this.action = undefined;\n\n    if (_this.type.indexOf('.') !== -1) {\n      var fields = _this.type.split('.', 3);\n\n      _this.type = fields[0];\n      _this.subtype = fields[1];\n      _this.action = fields[2];\n    }\n\n    _this.sync = _this.options.sync;\n    return _this;\n  }\n\n  var _proto = Span.prototype;\n\n  _proto.end = function end(endTime, data) {\n    _SpanBase.prototype.end.call(this, endTime);\n\n    addSpanContext(this, data);\n  };\n\n  return Span;\n}(SpanBase);\n\nexport default Span;","import Span from './span';\nimport { RESOURCE_INITIATOR_TYPES, MAX_SPAN_DURATION, USER_TIMING_THRESHOLD, PAGE_LOAD, RESOURCE, MEASURE } from '../common/constants';\nimport { stripQueryStringFromUrl, PERF, isPerfTimelineSupported } from '../common/utils';\nimport { state } from '../state';\nvar eventPairs = [['domainLookupStart', 'domainLookupEnd', 'Domain lookup'], ['connectStart', 'connectEnd', 'Making a connection to the server'], ['requestStart', 'responseEnd', 'Requesting and receiving the document'], ['domLoading', 'domInteractive', 'Parsing the document, executing sync. scripts'], ['domContentLoadedEventStart', 'domContentLoadedEventEnd', 'Fire \"DOMContentLoaded\" event'], ['loadEventStart', 'loadEventEnd', 'Fire \"load\" event']];\n\nfunction shouldCreateSpan(start, end, trStart, trEnd, baseTime) {\n  if (baseTime === void 0) {\n    baseTime = 0;\n  }\n\n  return typeof start === 'number' && typeof end === 'number' && start >= baseTime && end > start && start - baseTime >= trStart && end - baseTime <= trEnd && end - start < MAX_SPAN_DURATION && start - baseTime < MAX_SPAN_DURATION && end - baseTime < MAX_SPAN_DURATION;\n}\n\nfunction createNavigationTimingSpans(timings, baseTime, trStart, trEnd) {\n  var spans = [];\n\n  for (var i = 0; i < eventPairs.length; i++) {\n    var start = timings[eventPairs[i][0]];\n    var end = timings[eventPairs[i][1]];\n\n    if (!shouldCreateSpan(start, end, trStart, trEnd, baseTime)) {\n      continue;\n    }\n\n    var span = new Span(eventPairs[i][2], 'hard-navigation.browser-timing');\n    var data = null;\n\n    if (eventPairs[i][0] === 'requestStart') {\n      span.pageResponse = true;\n      data = {\n        url: location.origin\n      };\n    }\n\n    span._start = start - baseTime;\n    span.end(end - baseTime, data);\n    spans.push(span);\n  }\n\n  return spans;\n}\n\nfunction createResourceTimingSpan(resourceTimingEntry) {\n  var name = resourceTimingEntry.name,\n      initiatorType = resourceTimingEntry.initiatorType,\n      startTime = resourceTimingEntry.startTime,\n      responseEnd = resourceTimingEntry.responseEnd;\n  var kind = 'resource';\n\n  if (initiatorType) {\n    kind += '.' + initiatorType;\n  }\n\n  var spanName = stripQueryStringFromUrl(name);\n  var span = new Span(spanName, kind);\n  span._start = startTime;\n  span.end(responseEnd, {\n    url: name,\n    entry: resourceTimingEntry\n  });\n  return span;\n}\n\nfunction isCapturedByPatching(resourceStartTime, requestPatchTime) {\n  return requestPatchTime != null && resourceStartTime > requestPatchTime;\n}\n\nfunction isIntakeAPIEndpoint(url) {\n  return /intake\\/v\\d+\\/rum\\/events/.test(url);\n}\n\nfunction createResourceTimingSpans(entries, requestPatchTime, trStart, trEnd) {\n  var spans = [];\n\n  for (var i = 0; i < entries.length; i++) {\n    var _entries$i = entries[i],\n        initiatorType = _entries$i.initiatorType,\n        name = _entries$i.name,\n        startTime = _entries$i.startTime,\n        responseEnd = _entries$i.responseEnd;\n\n    if (RESOURCE_INITIATOR_TYPES.indexOf(initiatorType) === -1 || name == null) {\n      continue;\n    }\n\n    if ((initiatorType === 'xmlhttprequest' || initiatorType === 'fetch') && (isIntakeAPIEndpoint(name) || isCapturedByPatching(startTime, requestPatchTime))) {\n      continue;\n    }\n\n    if (shouldCreateSpan(startTime, responseEnd, trStart, trEnd)) {\n      spans.push(createResourceTimingSpan(entries[i]));\n    }\n  }\n\n  return spans;\n}\n\nfunction createUserTimingSpans(entries, trStart, trEnd) {\n  var userTimingSpans = [];\n\n  for (var i = 0; i < entries.length; i++) {\n    var _entries$i2 = entries[i],\n        name = _entries$i2.name,\n        startTime = _entries$i2.startTime,\n        duration = _entries$i2.duration;\n    var end = startTime + duration;\n\n    if (duration <= USER_TIMING_THRESHOLD || !shouldCreateSpan(startTime, end, trStart, trEnd)) {\n      continue;\n    }\n\n    var kind = 'app';\n    var span = new Span(name, kind);\n    span._start = startTime;\n    span.end(end);\n    userTimingSpans.push(span);\n  }\n\n  return userTimingSpans;\n}\n\nvar NAVIGATION_TIMING_MARKS = ['fetchStart', 'domainLookupStart', 'domainLookupEnd', 'connectStart', 'connectEnd', 'requestStart', 'responseStart', 'responseEnd', 'domLoading', 'domInteractive', 'domContentLoadedEventStart', 'domContentLoadedEventEnd', 'domComplete', 'loadEventStart', 'loadEventEnd'];\nvar COMPRESSED_NAV_TIMING_MARKS = ['fs', 'ls', 'le', 'cs', 'ce', 'qs', 'rs', 're', 'dl', 'di', 'ds', 'de', 'dc', 'es', 'ee'];\n\nfunction getNavigationTimingMarks(timing) {\n  var fetchStart = timing.fetchStart,\n      navigationStart = timing.navigationStart,\n      responseStart = timing.responseStart,\n      responseEnd = timing.responseEnd;\n\n  if (fetchStart >= navigationStart && responseStart >= fetchStart && responseEnd >= responseStart) {\n    var marks = {};\n    NAVIGATION_TIMING_MARKS.forEach(function (timingKey) {\n      var m = timing[timingKey];\n\n      if (m && m >= fetchStart) {\n        marks[timingKey] = parseInt(m - fetchStart);\n      }\n    });\n    return marks;\n  }\n\n  return null;\n}\n\nfunction getPageLoadMarks(timing) {\n  var marks = getNavigationTimingMarks(timing);\n\n  if (marks == null) {\n    return null;\n  }\n\n  return {\n    navigationTiming: marks,\n    agent: {\n      timeToFirstByte: marks.responseStart,\n      domInteractive: marks.domInteractive,\n      domComplete: marks.domComplete\n    }\n  };\n}\n\nfunction captureNavigation(transaction) {\n  if (!transaction.captureTimings) {\n    return;\n  }\n\n  var trEnd = transaction._end;\n\n  if (transaction.type === PAGE_LOAD) {\n    if (transaction.marks && transaction.marks.custom) {\n      var customMarks = transaction.marks.custom;\n      Object.keys(customMarks).forEach(function (key) {\n        customMarks[key] += transaction._start;\n      });\n    }\n\n    var trStart = 0;\n    transaction._start = trStart;\n    var timings = PERF.timing;\n    createNavigationTimingSpans(timings, timings.fetchStart, trStart, trEnd).forEach(function (span) {\n      span.traceId = transaction.traceId;\n      span.sampled = transaction.sampled;\n\n      if (span.pageResponse && transaction.options.pageLoadSpanId) {\n        span.id = transaction.options.pageLoadSpanId;\n      }\n\n      transaction.spans.push(span);\n    });\n    transaction.addMarks(getPageLoadMarks(timings));\n  }\n\n  if (isPerfTimelineSupported()) {\n    var _trStart = transaction._start;\n    var resourceEntries = PERF.getEntriesByType(RESOURCE);\n    createResourceTimingSpans(resourceEntries, state.bootstrapTime, _trStart, trEnd).forEach(function (span) {\n      return transaction.spans.push(span);\n    });\n    var userEntries = PERF.getEntriesByType(MEASURE);\n    createUserTimingSpans(userEntries, _trStart, trEnd).forEach(function (span) {\n      return transaction.spans.push(span);\n    });\n  }\n}\n\nexport { getPageLoadMarks, captureNavigation, createNavigationTimingSpans, createResourceTimingSpans, createUserTimingSpans, NAVIGATION_TIMING_MARKS, COMPRESSED_NAV_TIMING_MARKS };","import { Promise } from './polyfills';\nimport { NAVIGATION_TIMING_MARKS, COMPRESSED_NAV_TIMING_MARKS } from '../performance-monitoring/capture-navigation';\nimport { isBeaconInspectionEnabled } from './utils';\n\nfunction compressStackFrames(frames) {\n  return frames.map(function (frame) {\n    return {\n      ap: frame.abs_path,\n      f: frame.filename,\n      fn: frame.function,\n      li: frame.lineno,\n      co: frame.colno\n    };\n  });\n}\n\nfunction compressResponse(response) {\n  return {\n    ts: response.transfer_size,\n    ebs: response.encoded_body_size,\n    dbs: response.decoded_body_size\n  };\n}\n\nfunction compressHTTP(http) {\n  var compressed = {};\n  var method = http.method,\n      status_code = http.status_code,\n      url = http.url,\n      response = http.response;\n  compressed.url = url;\n\n  if (method) {\n    compressed.mt = method;\n  }\n\n  if (status_code) {\n    compressed.sc = status_code;\n  }\n\n  if (response) {\n    compressed.r = compressResponse(response);\n  }\n\n  return compressed;\n}\n\nfunction compressContext(context) {\n  if (!context) {\n    return null;\n  }\n\n  var compressed = {};\n  var page = context.page,\n      http = context.http,\n      response = context.response,\n      destination = context.destination,\n      user = context.user,\n      custom = context.custom;\n\n  if (page) {\n    compressed.p = {\n      rf: page.referer,\n      url: page.url\n    };\n  }\n\n  if (http) {\n    compressed.h = compressHTTP(http);\n  }\n\n  if (response) {\n    compressed.r = compressResponse(response);\n  }\n\n  if (destination) {\n    var service = destination.service;\n    compressed.dt = {\n      se: {\n        n: service.name,\n        t: service.type,\n        rc: service.resource\n      },\n      ad: destination.address,\n      po: destination.port\n    };\n  }\n\n  if (user) {\n    compressed.u = {\n      id: user.id,\n      un: user.username,\n      em: user.email\n    };\n  }\n\n  if (custom) {\n    compressed.cu = custom;\n  }\n\n  return compressed;\n}\n\nfunction compressMarks(marks) {\n  if (!marks) {\n    return null;\n  }\n\n  var compressedNtMarks = compressNavigationTimingMarks(marks.navigationTiming);\n  var compressed = {\n    nt: compressedNtMarks,\n    a: compressAgentMarks(compressedNtMarks, marks.agent)\n  };\n  return compressed;\n}\n\nfunction compressNavigationTimingMarks(ntMarks) {\n  if (!ntMarks) {\n    return null;\n  }\n\n  var compressed = {};\n  COMPRESSED_NAV_TIMING_MARKS.forEach(function (mark, index) {\n    var mapping = NAVIGATION_TIMING_MARKS[index];\n    compressed[mark] = ntMarks[mapping];\n  });\n  return compressed;\n}\n\nfunction compressAgentMarks(compressedNtMarks, agentMarks) {\n  var compressed = {};\n\n  if (compressedNtMarks) {\n    compressed = {\n      fb: compressedNtMarks.rs,\n      di: compressedNtMarks.di,\n      dc: compressedNtMarks.dc\n    };\n  }\n\n  if (agentMarks) {\n    var fp = agentMarks.firstContentfulPaint;\n    var lp = agentMarks.largestContentfulPaint;\n\n    if (fp) {\n      compressed.fp = fp;\n    }\n\n    if (lp) {\n      compressed.lp = lp;\n    }\n  }\n\n  if (Object.keys(compressed).length === 0) {\n    return null;\n  }\n\n  return compressed;\n}\n\nexport function compressMetadata(metadata) {\n  var service = metadata.service,\n      labels = metadata.labels;\n  var agent = service.agent,\n      language = service.language;\n  return {\n    se: {\n      n: service.name,\n      ve: service.version,\n      a: {\n        n: agent.name,\n        ve: agent.version\n      },\n      la: {\n        n: language.name\n      },\n      en: service.environment\n    },\n    l: labels\n  };\n}\nexport function compressTransaction(transaction) {\n  var spans = transaction.spans.map(function (span) {\n    var spanData = {\n      id: span.id,\n      n: span.name,\n      t: span.type,\n      s: span.start,\n      d: span.duration,\n      c: compressContext(span.context),\n      o: span.outcome,\n      sr: span.sample_rate\n    };\n\n    if (span.parent_id !== transaction.id) {\n      spanData.pid = span.parent_id;\n    }\n\n    if (span.sync === true) {\n      spanData.sy = true;\n    }\n\n    if (span.subtype) {\n      spanData.su = span.subtype;\n    }\n\n    if (span.action) {\n      spanData.ac = span.action;\n    }\n\n    return spanData;\n  });\n  var tr = {\n    id: transaction.id,\n    tid: transaction.trace_id,\n    n: transaction.name,\n    t: transaction.type,\n    d: transaction.duration,\n    c: compressContext(transaction.context),\n    k: compressMarks(transaction.marks),\n    me: compressMetricsets(transaction.breakdown),\n    y: spans,\n    yc: {\n      sd: spans.length\n    },\n    sm: transaction.sampled,\n    sr: transaction.sample_rate,\n    o: transaction.outcome\n  };\n\n  if (transaction.experience) {\n    var _transaction$experien = transaction.experience,\n        cls = _transaction$experien.cls,\n        fid = _transaction$experien.fid,\n        tbt = _transaction$experien.tbt,\n        longtask = _transaction$experien.longtask;\n    tr.exp = {\n      cls: cls,\n      fid: fid,\n      tbt: tbt,\n      lt: longtask\n    };\n  }\n\n  if (transaction.session) {\n    var _transaction$session = transaction.session,\n        id = _transaction$session.id,\n        sequence = _transaction$session.sequence;\n    tr.ses = {\n      id: id,\n      seq: sequence\n    };\n  }\n\n  return tr;\n}\nexport function compressError(error) {\n  var exception = error.exception;\n  var compressed = {\n    id: error.id,\n    cl: error.culprit,\n    ex: {\n      mg: exception.message,\n      st: compressStackFrames(exception.stacktrace),\n      t: error.type\n    },\n    c: compressContext(error.context)\n  };\n  var transaction = error.transaction;\n\n  if (transaction) {\n    compressed.tid = error.trace_id;\n    compressed.pid = error.parent_id;\n    compressed.xid = error.transaction_id;\n    compressed.x = {\n      t: transaction.type,\n      sm: transaction.sampled\n    };\n  }\n\n  return compressed;\n}\nexport function compressMetricsets(breakdowns) {\n  return breakdowns.map(function (_ref) {\n    var span = _ref.span,\n        samples = _ref.samples;\n    var isSpan = span != null;\n\n    if (isSpan) {\n      return {\n        y: {\n          t: span.type\n        },\n        sa: {\n          ysc: {\n            v: samples['span.self_time.count'].value\n          },\n          yss: {\n            v: samples['span.self_time.sum.us'].value\n          }\n        }\n      };\n    }\n\n    return {\n      sa: {\n        xdc: {\n          v: samples['transaction.duration.count'].value\n        },\n        xds: {\n          v: samples['transaction.duration.sum.us'].value\n        },\n        xbc: {\n          v: samples['transaction.breakdown.count'].value\n        }\n      }\n    };\n  });\n}\nexport function compressPayload(params, type) {\n  if (type === void 0) {\n    type = 'gzip';\n  }\n\n  var isCompressionStreamSupported = typeof CompressionStream === 'function';\n  return new Promise(function (resolve) {\n    if (!isCompressionStreamSupported) {\n      return resolve(params);\n    }\n\n    if (isBeaconInspectionEnabled()) {\n      return resolve(params);\n    }\n\n    var payload = params.payload,\n        headers = params.headers,\n        beforeSend = params.beforeSend;\n    var payloadStream = new Blob([payload]).stream();\n    var compressedStream = payloadStream.pipeThrough(new CompressionStream(type));\n    return new Response(compressedStream).blob().then(function (payload) {\n      headers['Content-Encoding'] = type;\n      return resolve({\n        payload: payload,\n        headers: headers,\n        beforeSend: beforeSend\n      });\n    });\n  });\n}","import { XHR_IGNORE } from '../patching/patch-utils';\nimport { isResponseSuccessful } from './response-status';\nimport { Promise } from '../polyfills';\nexport function sendXHR(method, url, _ref) {\n  var _ref$timeout = _ref.timeout,\n      timeout = _ref$timeout === void 0 ? HTTP_REQUEST_TIMEOUT : _ref$timeout,\n      payload = _ref.payload,\n      headers = _ref.headers,\n      beforeSend = _ref.beforeSend,\n      sendCredentials = _ref.sendCredentials;\n  return new Promise(function (resolve, reject) {\n    var xhr = new window.XMLHttpRequest();\n    xhr[XHR_IGNORE] = true;\n    xhr.open(method, url, true);\n    xhr.timeout = timeout;\n    xhr.withCredentials = sendCredentials;\n\n    if (headers) {\n      for (var header in headers) {\n        if (headers.hasOwnProperty(header)) {\n          xhr.setRequestHeader(header, headers[header]);\n        }\n      }\n    }\n\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState === 4) {\n        var status = xhr.status,\n            responseText = xhr.responseText;\n\n        if (isResponseSuccessful(status)) {\n          resolve(xhr);\n        } else {\n          reject({\n            url: url,\n            status: status,\n            responseText: responseText\n          });\n        }\n      }\n    };\n\n    xhr.onerror = function () {\n      var status = xhr.status,\n          responseText = xhr.responseText;\n      reject({\n        url: url,\n        status: status,\n        responseText: responseText\n      });\n    };\n\n    var canSend = true;\n\n    if (typeof beforeSend === 'function') {\n      canSend = beforeSend({\n        url: url,\n        method: method,\n        headers: headers,\n        payload: payload,\n        xhr: xhr\n      });\n    }\n\n    if (canSend) {\n      xhr.send(payload);\n    } else {\n      reject({\n        url: url,\n        status: 0,\n        responseText: 'Request rejected by user configuration.'\n      });\n    }\n  });\n}","import Queue from './queue';\nimport throttle from './throttle';\nimport NDJSON from './ndjson';\nimport { truncateModel, METADATA_MODEL } from './truncate';\nimport { ERRORS, HTTP_REQUEST_TIMEOUT, QUEUE_FLUSH, TRANSACTIONS } from './constants';\nimport { noop } from './utils';\nimport { Promise } from './polyfills';\nimport { compressMetadata, compressTransaction, compressError, compressPayload } from './compress';\nimport { __DEV__ } from '../state';\nimport { sendFetchRequest, shouldUseFetchWithKeepAlive } from './http/fetch';\nimport { sendXHR } from './http/xhr';\nvar THROTTLE_INTERVAL = 60000;\n\nvar ApmServer = function () {\n  function ApmServer(configService, loggingService) {\n    this._configService = configService;\n    this._loggingService = loggingService;\n    this.queue = undefined;\n    this.throttleEvents = noop;\n  }\n\n  var _proto = ApmServer.prototype;\n\n  _proto.init = function init() {\n    var _this = this;\n\n    var queueLimit = this._configService.get('queueLimit');\n\n    var flushInterval = this._configService.get('flushInterval');\n\n    var limit = this._configService.get('eventsLimit');\n\n    var onFlush = function onFlush(events) {\n      var promise = _this.sendEvents(events);\n\n      if (promise) {\n        promise.catch(function (reason) {\n          _this._loggingService.warn('Failed sending events!', _this._constructError(reason));\n        });\n      }\n    };\n\n    this.queue = new Queue(onFlush, {\n      queueLimit: queueLimit,\n      flushInterval: flushInterval\n    });\n    this.throttleEvents = throttle(this.queue.add.bind(this.queue), function () {\n      return _this._loggingService.warn('Dropped events due to throttling!');\n    }, {\n      limit: limit,\n      interval: THROTTLE_INTERVAL\n    });\n\n    this._configService.observeEvent(QUEUE_FLUSH, function () {\n      _this.queue.flush();\n    });\n  };\n\n  _proto._postJson = function _postJson(endPoint, payload) {\n    var _this2 = this;\n\n    var headers = {\n      'Content-Type': 'application/x-ndjson'\n    };\n\n    var apmRequest = this._configService.get('apmRequest');\n\n    var params = {\n      payload: payload,\n      headers: headers,\n      beforeSend: apmRequest\n    };\n    return compressPayload(params).catch(function (error) {\n      if (__DEV__) {\n        _this2._loggingService.debug('Compressing the payload using CompressionStream API failed', error.message);\n      }\n\n      return params;\n    }).then(function (result) {\n      return _this2._makeHttpRequest('POST', endPoint, result);\n    }).then(function (_ref) {\n      var responseText = _ref.responseText;\n      return responseText;\n    });\n  };\n\n  _proto._constructError = function _constructError(reason) {\n    var url = reason.url,\n        status = reason.status,\n        responseText = reason.responseText;\n\n    if (typeof status == 'undefined') {\n      return reason;\n    }\n\n    var message = url + ' HTTP status: ' + status;\n\n    if (__DEV__ && responseText) {\n      try {\n        var serverErrors = [];\n        var response = JSON.parse(responseText);\n\n        if (response.errors && response.errors.length > 0) {\n          response.errors.forEach(function (err) {\n            return serverErrors.push(err.message);\n          });\n          message += ' ' + serverErrors.join(',');\n        }\n      } catch (e) {\n        this._loggingService.debug('Error parsing response from APM server', e);\n      }\n    }\n\n    return new Error(message);\n  };\n\n  _proto._makeHttpRequest = function _makeHttpRequest(method, url, _temp) {\n    var _ref2 = _temp === void 0 ? {} : _temp,\n        _ref2$timeout = _ref2.timeout,\n        timeout = _ref2$timeout === void 0 ? HTTP_REQUEST_TIMEOUT : _ref2$timeout,\n        payload = _ref2.payload,\n        headers = _ref2.headers,\n        beforeSend = _ref2.beforeSend;\n\n    var sendCredentials = this._configService.get('sendCredentials');\n\n    if (!beforeSend && shouldUseFetchWithKeepAlive(method, payload)) {\n      return sendFetchRequest(method, url, {\n        keepalive: true,\n        timeout: timeout,\n        payload: payload,\n        headers: headers,\n        sendCredentials: sendCredentials\n      }).catch(function (reason) {\n        if (reason instanceof TypeError) {\n          return sendXHR(method, url, {\n            timeout: timeout,\n            payload: payload,\n            headers: headers,\n            beforeSend: beforeSend,\n            sendCredentials: sendCredentials\n          });\n        }\n\n        throw reason;\n      });\n    }\n\n    return sendXHR(method, url, {\n      timeout: timeout,\n      payload: payload,\n      headers: headers,\n      beforeSend: beforeSend,\n      sendCredentials: sendCredentials\n    });\n  };\n\n  _proto.fetchConfig = function fetchConfig(serviceName, environment) {\n    var _this3 = this;\n\n    var _this$getEndpoints = this.getEndpoints(),\n        configEndpoint = _this$getEndpoints.configEndpoint;\n\n    if (!serviceName) {\n      return Promise.reject('serviceName is required for fetching central config.');\n    }\n\n    configEndpoint += \"?service.name=\" + serviceName;\n\n    if (environment) {\n      configEndpoint += \"&service.environment=\" + environment;\n    }\n\n    var localConfig = this._configService.getLocalConfig();\n\n    if (localConfig) {\n      configEndpoint += \"&ifnonematch=\" + localConfig.etag;\n    }\n\n    var apmRequest = this._configService.get('apmRequest');\n\n    return this._makeHttpRequest('GET', configEndpoint, {\n      timeout: 5000,\n      beforeSend: apmRequest\n    }).then(function (xhr) {\n      var status = xhr.status,\n          responseText = xhr.responseText;\n\n      if (status === 304) {\n        return localConfig;\n      } else {\n        var remoteConfig = JSON.parse(responseText);\n        var etag = xhr.getResponseHeader('etag');\n\n        if (etag) {\n          remoteConfig.etag = etag.replace(/[\"]/g, '');\n\n          _this3._configService.setLocalConfig(remoteConfig, true);\n        }\n\n        return remoteConfig;\n      }\n    }).catch(function (reason) {\n      var error = _this3._constructError(reason);\n\n      return Promise.reject(error);\n    });\n  };\n\n  _proto.createMetaData = function createMetaData() {\n    var cfg = this._configService;\n    var metadata = {\n      service: {\n        name: cfg.get('serviceName'),\n        version: cfg.get('serviceVersion'),\n        agent: {\n          name: 'rum-js',\n          version: cfg.version\n        },\n        language: {\n          name: 'javascript'\n        },\n        environment: cfg.get('environment')\n      },\n      labels: cfg.get('context.tags')\n    };\n    return truncateModel(METADATA_MODEL, metadata);\n  };\n\n  _proto.addError = function addError(error) {\n    var _this$throttleEvents;\n\n    this.throttleEvents((_this$throttleEvents = {}, _this$throttleEvents[ERRORS] = error, _this$throttleEvents));\n  };\n\n  _proto.addTransaction = function addTransaction(transaction) {\n    var _this$throttleEvents2;\n\n    this.throttleEvents((_this$throttleEvents2 = {}, _this$throttleEvents2[TRANSACTIONS] = transaction, _this$throttleEvents2));\n  };\n\n  _proto.ndjsonErrors = function ndjsonErrors(errors, compress) {\n    var key = compress ? 'e' : 'error';\n    return errors.map(function (error) {\n      var _NDJSON$stringify;\n\n      return NDJSON.stringify((_NDJSON$stringify = {}, _NDJSON$stringify[key] = compress ? compressError(error) : error, _NDJSON$stringify));\n    });\n  };\n\n  _proto.ndjsonMetricsets = function ndjsonMetricsets(metricsets) {\n    return metricsets.map(function (metricset) {\n      return NDJSON.stringify({\n        metricset: metricset\n      });\n    }).join('');\n  };\n\n  _proto.ndjsonTransactions = function ndjsonTransactions(transactions, compress) {\n    var _this4 = this;\n\n    var key = compress ? 'x' : 'transaction';\n    return transactions.map(function (tr) {\n      var _NDJSON$stringify2;\n\n      var spans = '',\n          breakdowns = '';\n\n      if (!compress) {\n        if (tr.spans) {\n          spans = tr.spans.map(function (span) {\n            return NDJSON.stringify({\n              span: span\n            });\n          }).join('');\n          delete tr.spans;\n        }\n\n        if (tr.breakdown) {\n          breakdowns = _this4.ndjsonMetricsets(tr.breakdown);\n          delete tr.breakdown;\n        }\n      }\n\n      return NDJSON.stringify((_NDJSON$stringify2 = {}, _NDJSON$stringify2[key] = compress ? compressTransaction(tr) : tr, _NDJSON$stringify2)) + spans + breakdowns;\n    });\n  };\n\n  _proto.sendEvents = function sendEvents(events) {\n    var _payload, _NDJSON$stringify3;\n\n    if (events.length === 0) {\n      return;\n    }\n\n    var transactions = [];\n    var errors = [];\n\n    for (var i = 0; i < events.length; i++) {\n      var event = events[i];\n\n      if (event[TRANSACTIONS]) {\n        transactions.push(event[TRANSACTIONS]);\n      }\n\n      if (event[ERRORS]) {\n        errors.push(event[ERRORS]);\n      }\n    }\n\n    if (transactions.length === 0 && errors.length === 0) {\n      return;\n    }\n\n    var cfg = this._configService;\n    var payload = (_payload = {}, _payload[TRANSACTIONS] = transactions, _payload[ERRORS] = errors, _payload);\n    var filteredPayload = cfg.applyFilters(payload);\n\n    if (!filteredPayload) {\n      this._loggingService.warn('Dropped payload due to filtering!');\n\n      return;\n    }\n\n    var apiVersion = cfg.get('apiVersion');\n    var compress = apiVersion > 2;\n    var ndjson = [];\n    var metadata = this.createMetaData();\n    var metadataKey = compress ? 'm' : 'metadata';\n    ndjson.push(NDJSON.stringify((_NDJSON$stringify3 = {}, _NDJSON$stringify3[metadataKey] = compress ? compressMetadata(metadata) : metadata, _NDJSON$stringify3)));\n    ndjson = ndjson.concat(this.ndjsonErrors(filteredPayload[ERRORS], compress), this.ndjsonTransactions(filteredPayload[TRANSACTIONS], compress));\n    var ndjsonPayload = ndjson.join('');\n\n    var _this$getEndpoints2 = this.getEndpoints(),\n        intakeEndpoint = _this$getEndpoints2.intakeEndpoint;\n\n    return this._postJson(intakeEndpoint, ndjsonPayload);\n  };\n\n  _proto.getEndpoints = function getEndpoints() {\n    var serverUrl = this._configService.get('serverUrl');\n\n    var apiVersion = this._configService.get('apiVersion');\n\n    var serverUrlPrefix = this._configService.get('serverUrlPrefix') || \"/intake/v\" + apiVersion + \"/rum/events\";\n    var intakeEndpoint = serverUrl + serverUrlPrefix;\n    var configEndpoint = serverUrl + \"/config/v1/rum/agents\";\n    return {\n      intakeEndpoint: intakeEndpoint,\n      configEndpoint: configEndpoint\n    };\n  };\n\n  return ApmServer;\n}();\n\nexport default ApmServer;","export default function throttle(fn, onThrottle, opts) {\n  var context = this;\n  var limit = opts.limit;\n  var interval = opts.interval;\n  var counter = 0;\n  var timeoutId;\n  return function () {\n    counter++;\n\n    if (typeof timeoutId === 'undefined') {\n      timeoutId = setTimeout(function () {\n        counter = 0;\n        timeoutId = undefined;\n      }, interval);\n    }\n\n    if (counter > limit && typeof onThrottle === 'function') {\n      return onThrottle.apply(context, arguments);\n    } else {\n      return fn.apply(context, arguments);\n    }\n  };\n}","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport { getCurrentScript, setLabel, merge, extend, isUndefined } from './utils';\nimport EventHandler from './event-handler';\nimport { CONFIG_CHANGE, LOCAL_CONFIG_KEY } from './constants';\n\nfunction getConfigFromScript() {\n  var script = getCurrentScript();\n  var config = getDataAttributesFromNode(script);\n  return config;\n}\n\nfunction getDataAttributesFromNode(node) {\n  if (!node) {\n    return {};\n  }\n\n  var dataAttrs = {};\n  var dataRegex = /^data-([\\w-]+)$/;\n  var attrs = node.attributes;\n\n  for (var i = 0; i < attrs.length; i++) {\n    var attr = attrs[i];\n\n    if (dataRegex.test(attr.nodeName)) {\n      var key = attr.nodeName.match(dataRegex)[1];\n      var camelCasedkey = key.split('-').map(function (value, index) {\n        return index > 0 ? value.charAt(0).toUpperCase() + value.substring(1) : value;\n      }).join('');\n      dataAttrs[camelCasedkey] = attr.value || attr.nodeValue;\n    }\n  }\n\n  return dataAttrs;\n}\n\nvar Config = function () {\n  function Config() {\n    this.config = {\n      serviceName: '',\n      serviceVersion: '',\n      environment: '',\n      serverUrl: 'http://localhost:8200',\n      serverUrlPrefix: '',\n      active: true,\n      instrument: true,\n      disableInstrumentations: [],\n      logLevel: 'warn',\n      breakdownMetrics: false,\n      ignoreTransactions: [],\n      eventsLimit: 80,\n      queueLimit: -1,\n      flushInterval: 500,\n      distributedTracing: true,\n      distributedTracingOrigins: [],\n      distributedTracingHeaderName: 'traceparent',\n      pageLoadTraceId: '',\n      pageLoadSpanId: '',\n      pageLoadSampled: false,\n      pageLoadTransactionName: '',\n      propagateTracestate: false,\n      transactionSampleRate: 1.0,\n      centralConfig: false,\n      monitorLongtasks: true,\n      apiVersion: 2,\n      context: {},\n      session: false,\n      apmRequest: null,\n      sendCredentials: false\n    };\n    this.events = new EventHandler();\n    this.filters = [];\n    this.version = '';\n  }\n\n  var _proto = Config.prototype;\n\n  _proto.init = function init() {\n    var scriptData = getConfigFromScript();\n    this.setConfig(scriptData);\n  };\n\n  _proto.setVersion = function setVersion(version) {\n    this.version = version;\n  };\n\n  _proto.addFilter = function addFilter(cb) {\n    if (typeof cb !== 'function') {\n      throw new Error('Argument to must be function');\n    }\n\n    this.filters.push(cb);\n  };\n\n  _proto.applyFilters = function applyFilters(data) {\n    for (var i = 0; i < this.filters.length; i++) {\n      data = this.filters[i](data);\n\n      if (!data) {\n        return;\n      }\n    }\n\n    return data;\n  };\n\n  _proto.get = function get(key) {\n    return key.split('.').reduce(function (obj, objKey) {\n      return obj && obj[objKey];\n    }, this.config);\n  };\n\n  _proto.setUserContext = function setUserContext(userContext) {\n    if (userContext === void 0) {\n      userContext = {};\n    }\n\n    var context = {};\n    var _userContext = userContext,\n        id = _userContext.id,\n        username = _userContext.username,\n        email = _userContext.email;\n\n    if (typeof id === 'number' || typeof id === 'string') {\n      context.id = id;\n    }\n\n    if (typeof username === 'string') {\n      context.username = username;\n    }\n\n    if (typeof email === 'string') {\n      context.email = email;\n    }\n\n    this.config.context.user = extend(this.config.context.user || {}, context);\n  };\n\n  _proto.setCustomContext = function setCustomContext(customContext) {\n    if (customContext === void 0) {\n      customContext = {};\n    }\n\n    this.config.context.custom = extend(this.config.context.custom || {}, customContext);\n  };\n\n  _proto.addLabels = function addLabels(tags) {\n    var _this = this;\n\n    if (!this.config.context.tags) {\n      this.config.context.tags = {};\n    }\n\n    var keys = Object.keys(tags);\n    keys.forEach(function (k) {\n      return setLabel(k, tags[k], _this.config.context.tags);\n    });\n  };\n\n  _proto.setConfig = function setConfig(properties) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    var _properties = properties,\n        transactionSampleRate = _properties.transactionSampleRate,\n        serverUrl = _properties.serverUrl;\n\n    if (serverUrl) {\n      properties.serverUrl = serverUrl.replace(/\\/+$/, '');\n    }\n\n    if (!isUndefined(transactionSampleRate)) {\n      if (transactionSampleRate < 0.0001 && transactionSampleRate > 0) {\n        transactionSampleRate = 0.0001;\n      }\n\n      properties.transactionSampleRate = Math.round(transactionSampleRate * 10000) / 10000;\n    }\n\n    merge(this.config, properties);\n    this.events.send(CONFIG_CHANGE, [this.config]);\n  };\n\n  _proto.validate = function validate(properties) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    var requiredKeys = ['serviceName', 'serverUrl'];\n    var allKeys = Object.keys(this.config);\n    var errors = {\n      missing: [],\n      invalid: [],\n      unknown: []\n    };\n    Object.keys(properties).forEach(function (key) {\n      if (requiredKeys.indexOf(key) !== -1 && !properties[key]) {\n        errors.missing.push(key);\n      }\n\n      if (allKeys.indexOf(key) === -1) {\n        errors.unknown.push(key);\n      }\n    });\n\n    if (properties.serviceName && !/^[a-zA-Z0-9 _-]+$/.test(properties.serviceName)) {\n      errors.invalid.push({\n        key: 'serviceName',\n        value: properties.serviceName,\n        allowed: 'a-z, A-Z, 0-9, _, -, <space>'\n      });\n    }\n\n    var sampleRate = properties.transactionSampleRate;\n\n    if (typeof sampleRate !== 'undefined' && (typeof sampleRate !== 'number' || isNaN(sampleRate) || sampleRate < 0 || sampleRate > 1)) {\n      errors.invalid.push({\n        key: 'transactionSampleRate',\n        value: sampleRate,\n        allowed: 'Number between 0 and 1'\n      });\n    }\n\n    return errors;\n  };\n\n  _proto.getLocalConfig = function getLocalConfig() {\n    var storage = sessionStorage;\n\n    if (this.config.session) {\n      storage = localStorage;\n    }\n\n    var config = storage.getItem(LOCAL_CONFIG_KEY);\n\n    if (config) {\n      return JSON.parse(config);\n    }\n  };\n\n  _proto.setLocalConfig = function setLocalConfig(config, merge) {\n    if (config) {\n      if (merge) {\n        var prevConfig = this.getLocalConfig();\n        config = _extends({}, prevConfig, config);\n      }\n\n      var storage = sessionStorage;\n\n      if (this.config.session) {\n        storage = localStorage;\n      }\n\n      storage.setItem(LOCAL_CONFIG_KEY, JSON.stringify(config));\n    }\n  };\n\n  _proto.dispatchEvent = function dispatchEvent(name, args) {\n    this.events.send(name, args);\n  };\n\n  _proto.observeEvent = function observeEvent(name, fn) {\n    return this.events.observe(name, fn);\n  };\n\n  return Config;\n}();\n\nexport default Config;","var _serviceCreators;\n\nimport ApmServer from './apm-server';\nimport ConfigService from './config-service';\nimport LoggingService from './logging-service';\nimport { CONFIG_CHANGE, CONFIG_SERVICE, LOGGING_SERVICE, APM_SERVER } from './constants';\nimport { __DEV__ } from '../state';\nvar serviceCreators = (_serviceCreators = {}, _serviceCreators[CONFIG_SERVICE] = function () {\n  return new ConfigService();\n}, _serviceCreators[LOGGING_SERVICE] = function () {\n  return new LoggingService({\n    prefix: '[Elastic APM] '\n  });\n}, _serviceCreators[APM_SERVER] = function (factory) {\n  var _factory$getService = factory.getService([CONFIG_SERVICE, LOGGING_SERVICE]),\n      configService = _factory$getService[0],\n      loggingService = _factory$getService[1];\n\n  return new ApmServer(configService, loggingService);\n}, _serviceCreators);\n\nvar ServiceFactory = function () {\n  function ServiceFactory() {\n    this.instances = {};\n    this.initialized = false;\n  }\n\n  var _proto = ServiceFactory.prototype;\n\n  _proto.init = function init() {\n    if (this.initialized) {\n      return;\n    }\n\n    this.initialized = true;\n    var configService = this.getService(CONFIG_SERVICE);\n    configService.init();\n\n    var _this$getService = this.getService([LOGGING_SERVICE, APM_SERVER]),\n        loggingService = _this$getService[0],\n        apmServer = _this$getService[1];\n\n    configService.events.observe(CONFIG_CHANGE, function () {\n      var logLevel = configService.get('logLevel');\n      loggingService.setLevel(logLevel);\n    });\n    apmServer.init();\n  };\n\n  _proto.getService = function getService(name) {\n    var _this = this;\n\n    if (typeof name === 'string') {\n      if (!this.instances[name]) {\n        if (typeof serviceCreators[name] === 'function') {\n          this.instances[name] = serviceCreators[name](this);\n        } else if (__DEV__) {\n          console.log('Cannot get service, No creator for: ' + name);\n        }\n      }\n\n      return this.instances[name];\n    } else if (Array.isArray(name)) {\n      return name.map(function (n) {\n        return _this.getService(n);\n      });\n    }\n  };\n\n  return ServiceFactory;\n}();\n\nexport { serviceCreators, ServiceFactory };","import { noop } from './utils';\n\nvar LoggingService = function () {\n  function LoggingService(spec) {\n    if (spec === void 0) {\n      spec = {};\n    }\n\n    this.levels = ['trace', 'debug', 'info', 'warn', 'error'];\n    this.level = spec.level || 'warn';\n    this.prefix = spec.prefix || '';\n    this.resetLogMethods();\n  }\n\n  var _proto = LoggingService.prototype;\n\n  _proto.shouldLog = function shouldLog(level) {\n    return this.levels.indexOf(level) >= this.levels.indexOf(this.level);\n  };\n\n  _proto.setLevel = function setLevel(level) {\n    if (level === this.level) {\n      return;\n    }\n\n    this.level = level;\n    this.resetLogMethods();\n  };\n\n  _proto.resetLogMethods = function resetLogMethods() {\n    var _this = this;\n\n    this.levels.forEach(function (level) {\n      _this[level] = _this.shouldLog(level) ? log : noop;\n\n      function log() {\n        var normalizedLevel = level;\n\n        if (level === 'trace' || level === 'debug') {\n          normalizedLevel = 'info';\n        }\n\n        var args = arguments;\n        args[0] = this.prefix + args[0];\n\n        if (console) {\n          var realMethod = console[normalizedLevel] || console.log;\n\n          if (typeof realMethod === 'function') {\n            realMethod.apply(console, args);\n          }\n        }\n      }\n    });\n  };\n\n  return LoggingService;\n}();\n\nexport default LoggingService;","import { checkSameOrigin, isDtHeaderValid, parseDtHeaderValue, getDtHeaderValue, getTSHeaderValue, stripQueryStringFromUrl, setRequestHeader } from '../common/utils';\nimport { Url } from '../common/url';\nimport { patchEventHandler } from '../common/patching';\nimport { globalState } from '../common/patching/patch-utils';\nimport { SCHEDULE, INVOKE, TRANSACTION_END, AFTER_EVENT, FETCH, HISTORY, XMLHTTPREQUEST, HTTP_REQUEST_TYPE, OUTCOME_FAILURE, OUTCOME_SUCCESS, OUTCOME_UNKNOWN, QUEUE_ADD_TRANSACTION } from '../common/constants';\nimport { truncateModel, SPAN_MODEL, TRANSACTION_MODEL } from '../common/truncate';\nimport { __DEV__ } from '../state';\nvar SIMILAR_SPAN_TO_TRANSACTION_RATIO = 0.05;\nvar TRANSACTION_DURATION_THRESHOLD = 60000;\nexport function groupSmallContinuouslySimilarSpans(originalSpans, transDuration, threshold) {\n  originalSpans.sort(function (spanA, spanB) {\n    return spanA._start - spanB._start;\n  });\n  var spans = [];\n  var lastCount = 1;\n  originalSpans.forEach(function (span, index) {\n    if (spans.length === 0) {\n      spans.push(span);\n    } else {\n      var lastSpan = spans[spans.length - 1];\n      var isContinuouslySimilar = lastSpan.type === span.type && lastSpan.subtype === span.subtype && lastSpan.action === span.action && lastSpan.name === span.name && span.duration() / transDuration < threshold && (span._start - lastSpan._end) / transDuration < threshold;\n      var isLastSpan = originalSpans.length === index + 1;\n\n      if (isContinuouslySimilar) {\n        lastCount++;\n        lastSpan._end = span._end;\n      }\n\n      if (lastCount > 1 && (!isContinuouslySimilar || isLastSpan)) {\n        lastSpan.name = lastCount + 'x ' + lastSpan.name;\n        lastCount = 1;\n      }\n\n      if (!isContinuouslySimilar) {\n        spans.push(span);\n      }\n    }\n  });\n  return spans;\n}\nexport function adjustTransaction(transaction) {\n  if (transaction.sampled) {\n    var filterdSpans = transaction.spans.filter(function (span) {\n      return span.duration() > 0 && span._start >= transaction._start && span._end <= transaction._end;\n    });\n\n    if (transaction.isManaged()) {\n      var duration = transaction.duration();\n      var similarSpans = groupSmallContinuouslySimilarSpans(filterdSpans, duration, SIMILAR_SPAN_TO_TRANSACTION_RATIO);\n      transaction.spans = similarSpans;\n    } else {\n      transaction.spans = filterdSpans;\n    }\n  } else {\n    transaction.resetFields();\n  }\n\n  return transaction;\n}\n\nvar PerformanceMonitoring = function () {\n  function PerformanceMonitoring(apmServer, configService, loggingService, transactionService) {\n    this._apmServer = apmServer;\n    this._configService = configService;\n    this._logginService = loggingService;\n    this._transactionService = transactionService;\n  }\n\n  var _proto = PerformanceMonitoring.prototype;\n\n  _proto.init = function init(flags) {\n    var _this = this;\n\n    if (flags === void 0) {\n      flags = {};\n    }\n\n    this._configService.events.observe(TRANSACTION_END + AFTER_EVENT, function (tr) {\n      var payload = _this.createTransactionPayload(tr);\n\n      if (payload) {\n        _this._apmServer.addTransaction(payload);\n\n        _this._configService.dispatchEvent(QUEUE_ADD_TRANSACTION);\n      }\n    });\n\n    if (flags[HISTORY]) {\n      patchEventHandler.observe(HISTORY, this.getHistorySub());\n    }\n\n    if (flags[XMLHTTPREQUEST]) {\n      patchEventHandler.observe(XMLHTTPREQUEST, this.getXHRSub());\n    }\n\n    if (flags[FETCH]) {\n      patchEventHandler.observe(FETCH, this.getFetchSub());\n    }\n  };\n\n  _proto.getHistorySub = function getHistorySub() {\n    var transactionService = this._transactionService;\n    return function (event, task) {\n      if (task.source === HISTORY && event === INVOKE) {\n        transactionService.startTransaction(task.data.title, 'route-change', {\n          managed: true,\n          canReuse: true\n        });\n      }\n    };\n  };\n\n  _proto.getXHRSub = function getXHRSub() {\n    var _this2 = this;\n\n    return function (event, task) {\n      if (task.source === XMLHTTPREQUEST && !globalState.fetchInProgress) {\n        _this2.processAPICalls(event, task);\n      }\n    };\n  };\n\n  _proto.getFetchSub = function getFetchSub() {\n    var _this3 = this;\n\n    return function (event, task) {\n      if (task.source === FETCH) {\n        _this3.processAPICalls(event, task);\n      }\n    };\n  };\n\n  _proto.processAPICalls = function processAPICalls(event, task) {\n    var configService = this._configService;\n    var transactionService = this._transactionService;\n\n    if (task.data && task.data.url) {\n      var endpoints = this._apmServer.getEndpoints();\n\n      var isOwnEndpoint = Object.keys(endpoints).some(function (endpoint) {\n        return task.data.url.indexOf(endpoints[endpoint]) !== -1;\n      });\n\n      if (isOwnEndpoint) {\n        return;\n      }\n    }\n\n    if (event === SCHEDULE && task.data) {\n      var data = task.data;\n      var requestUrl = new Url(data.url);\n      var spanName = data.method + ' ' + (requestUrl.relative ? requestUrl.path : stripQueryStringFromUrl(requestUrl.href));\n\n      if (!transactionService.getCurrentTransaction()) {\n        transactionService.startTransaction(spanName, HTTP_REQUEST_TYPE, {\n          managed: true\n        });\n      }\n\n      var span = transactionService.startSpan(spanName, 'external.http', {\n        blocking: true\n      });\n\n      if (!span) {\n        return;\n      }\n\n      var isDtEnabled = configService.get('distributedTracing');\n      var dtOrigins = configService.get('distributedTracingOrigins');\n      var currentUrl = new Url(window.location.href);\n      var isSameOrigin = checkSameOrigin(requestUrl.origin, currentUrl.origin) || checkSameOrigin(requestUrl.origin, dtOrigins);\n      var target = data.target;\n\n      if (isDtEnabled && isSameOrigin && target) {\n        this.injectDtHeader(span, target);\n        var propagateTracestate = configService.get('propagateTracestate');\n\n        if (propagateTracestate) {\n          this.injectTSHeader(span, target);\n        }\n      } else if (__DEV__) {\n        this._logginService.debug(\"Could not inject distributed tracing header to the request origin ('\" + requestUrl.origin + \"') from the current origin ('\" + currentUrl.origin + \"')\");\n      }\n\n      if (data.sync) {\n        span.sync = data.sync;\n      }\n\n      data.span = span;\n    } else if (event === INVOKE) {\n      var _data = task.data;\n\n      if (_data && _data.span) {\n        var _span = _data.span,\n            response = _data.response,\n            _target = _data.target;\n        var status;\n\n        if (response) {\n          status = response.status;\n        } else {\n          status = _target.status;\n        }\n\n        var outcome;\n\n        if (_data.status != 'abort' && !_data.aborted) {\n          if (status >= 400 || status == 0) {\n            outcome = OUTCOME_FAILURE;\n          } else {\n            outcome = OUTCOME_SUCCESS;\n          }\n        } else {\n          outcome = OUTCOME_UNKNOWN;\n        }\n\n        _span.outcome = outcome;\n        var tr = transactionService.getCurrentTransaction();\n\n        if (tr && tr.type === HTTP_REQUEST_TYPE) {\n          tr.outcome = outcome;\n        }\n\n        transactionService.endSpan(_span, _data);\n      }\n    }\n  };\n\n  _proto.injectDtHeader = function injectDtHeader(span, target) {\n    var headerName = this._configService.get('distributedTracingHeaderName');\n\n    var headerValue = getDtHeaderValue(span);\n    var isHeaderValid = isDtHeaderValid(headerValue);\n\n    if (isHeaderValid && headerValue && headerName) {\n      setRequestHeader(target, headerName, headerValue);\n    }\n  };\n\n  _proto.injectTSHeader = function injectTSHeader(span, target) {\n    var headerValue = getTSHeaderValue(span);\n\n    if (headerValue) {\n      setRequestHeader(target, 'tracestate', headerValue);\n    }\n  };\n\n  _proto.extractDtHeader = function extractDtHeader(target) {\n    var configService = this._configService;\n    var headerName = configService.get('distributedTracingHeaderName');\n\n    if (target) {\n      return parseDtHeaderValue(target[headerName]);\n    }\n  };\n\n  _proto.filterTransaction = function filterTransaction(tr) {\n    var duration = tr.duration();\n\n    if (!duration) {\n      if (__DEV__) {\n        var message = \"transaction(\" + tr.id + \", \" + tr.name + \") was discarded! \";\n\n        if (duration === 0) {\n          message += \"Transaction duration is 0\";\n        } else {\n          message += \"Transaction wasn't ended\";\n        }\n\n        this._logginService.debug(message);\n      }\n\n      return false;\n    }\n\n    if (tr.isManaged()) {\n      if (duration > TRANSACTION_DURATION_THRESHOLD) {\n        if (__DEV__) {\n          this._logginService.debug(\"transaction(\" + tr.id + \", \" + tr.name + \") was discarded! Transaction duration (\" + duration + \") is greater than managed transaction threshold (\" + TRANSACTION_DURATION_THRESHOLD + \")\");\n        }\n\n        return false;\n      }\n\n      if (tr.sampled && tr.spans.length === 0) {\n        if (__DEV__) {\n          this._logginService.debug(\"transaction(\" + tr.id + \", \" + tr.name + \") was discarded! Transaction does not have any spans\");\n        }\n\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  _proto.createTransactionDataModel = function createTransactionDataModel(transaction) {\n    var transactionStart = transaction._start;\n    var spans = transaction.spans.map(function (span) {\n      var spanData = {\n        id: span.id,\n        transaction_id: transaction.id,\n        parent_id: span.parentId || transaction.id,\n        trace_id: transaction.traceId,\n        name: span.name,\n        type: span.type,\n        subtype: span.subtype,\n        action: span.action,\n        sync: span.sync,\n        start: parseInt(span._start - transactionStart),\n        duration: span.duration(),\n        context: span.context,\n        outcome: span.outcome,\n        sample_rate: span.sampleRate\n      };\n      return truncateModel(SPAN_MODEL, spanData);\n    });\n    var transactionData = {\n      id: transaction.id,\n      trace_id: transaction.traceId,\n      session: transaction.session,\n      name: transaction.name,\n      type: transaction.type,\n      duration: transaction.duration(),\n      spans: spans,\n      context: transaction.context,\n      marks: transaction.marks,\n      breakdown: transaction.breakdownTimings,\n      span_count: {\n        started: spans.length\n      },\n      sampled: transaction.sampled,\n      sample_rate: transaction.sampleRate,\n      experience: transaction.experience,\n      outcome: transaction.outcome\n    };\n    return truncateModel(TRANSACTION_MODEL, transactionData);\n  };\n\n  _proto.createTransactionPayload = function createTransactionPayload(transaction) {\n    var adjustedTransaction = adjustTransaction(transaction);\n    var filtered = this.filterTransaction(adjustedTransaction);\n\n    if (filtered) {\n      return this.createTransactionDataModel(transaction);\n    }\n  };\n\n  return PerformanceMonitoring;\n}();\n\nexport { PerformanceMonitoring as default };","import { getDuration, PERF } from '../common/utils';\nimport { PAGE_LOAD, TRUNCATED_TYPE } from '../common/constants';\nvar pageLoadBreakdowns = [['domainLookupStart', 'domainLookupEnd', 'DNS'], ['connectStart', 'connectEnd', 'TCP'], ['requestStart', 'responseStart', 'Request'], ['responseStart', 'responseEnd', 'Response'], ['domLoading', 'domComplete', 'Processing'], ['loadEventStart', 'loadEventEnd', 'Load']];\n\nfunction getValue(value) {\n  return {\n    value: value\n  };\n}\n\nfunction calculateSelfTime(transaction) {\n  var spans = transaction.spans,\n      _start = transaction._start,\n      _end = transaction._end;\n\n  if (spans.length === 0) {\n    return transaction.duration();\n  }\n\n  spans.sort(function (span1, span2) {\n    return span1._start - span2._start;\n  });\n  var span = spans[0];\n  var spanEnd = span._end;\n  var spanStart = span._start;\n  var lastContinuousEnd = spanEnd;\n  var selfTime = spanStart - _start;\n\n  for (var i = 1; i < spans.length; i++) {\n    span = spans[i];\n    spanStart = span._start;\n    spanEnd = span._end;\n\n    if (spanStart > lastContinuousEnd) {\n      selfTime += spanStart - lastContinuousEnd;\n      lastContinuousEnd = spanEnd;\n    } else if (spanEnd > lastContinuousEnd) {\n      lastContinuousEnd = spanEnd;\n    }\n  }\n\n  if (lastContinuousEnd < _end) {\n    selfTime += _end - lastContinuousEnd;\n  }\n\n  return selfTime;\n}\n\nfunction groupSpans(transaction) {\n  var spanMap = {};\n  var transactionSelfTime = calculateSelfTime(transaction);\n  spanMap['app'] = {\n    count: 1,\n    duration: transactionSelfTime\n  };\n  var spans = transaction.spans;\n\n  for (var i = 0; i < spans.length; i++) {\n    var span = spans[i];\n    var duration = span.duration();\n\n    if (duration === 0 || duration == null) {\n      continue;\n    }\n\n    var type = span.type,\n        subtype = span.subtype;\n    var key = type.replace(TRUNCATED_TYPE, '');\n\n    if (subtype) {\n      key += '.' + subtype;\n    }\n\n    if (!spanMap[key]) {\n      spanMap[key] = {\n        duration: 0,\n        count: 0\n      };\n    }\n\n    spanMap[key].count++;\n    spanMap[key].duration += duration;\n  }\n\n  return spanMap;\n}\n\nfunction getSpanBreakdown(transactionDetails, _ref) {\n  var details = _ref.details,\n      _ref$count = _ref.count,\n      count = _ref$count === void 0 ? 1 : _ref$count,\n      duration = _ref.duration;\n  return {\n    transaction: transactionDetails,\n    span: details,\n    samples: {\n      'span.self_time.count': getValue(count),\n      'span.self_time.sum.us': getValue(duration)\n    }\n  };\n}\n\nexport function captureBreakdown(transaction, timings) {\n  if (timings === void 0) {\n    timings = PERF.timing;\n  }\n\n  var breakdowns = [];\n  var trDuration = transaction.duration();\n  var name = transaction.name,\n      type = transaction.type,\n      sampled = transaction.sampled;\n  var transactionDetails = {\n    name: name,\n    type: type\n  };\n  breakdowns.push({\n    transaction: transactionDetails,\n    samples: {\n      'transaction.duration.count': getValue(1),\n      'transaction.duration.sum.us': getValue(trDuration),\n      'transaction.breakdown.count': getValue(sampled ? 1 : 0)\n    }\n  });\n\n  if (!sampled) {\n    return breakdowns;\n  }\n\n  if (type === PAGE_LOAD && timings) {\n    for (var i = 0; i < pageLoadBreakdowns.length; i++) {\n      var current = pageLoadBreakdowns[i];\n      var start = timings[current[0]];\n      var end = timings[current[1]];\n      var duration = getDuration(start, end);\n\n      if (duration === 0 || duration == null) {\n        continue;\n      }\n\n      breakdowns.push(getSpanBreakdown(transactionDetails, {\n        details: {\n          type: current[2]\n        },\n        duration: duration\n      }));\n    }\n  } else {\n    var spanMap = groupSpans(transaction);\n    Object.keys(spanMap).forEach(function (key) {\n      var _key$split = key.split('.'),\n          type = _key$split[0],\n          subtype = _key$split[1];\n\n      var _spanMap$key = spanMap[key],\n          duration = _spanMap$key.duration,\n          count = _spanMap$key.count;\n      breakdowns.push(getSpanBreakdown(transactionDetails, {\n        details: {\n          type: type,\n          subtype: subtype\n        },\n        duration: duration,\n        count: count\n      }));\n    });\n  }\n\n  return breakdowns;\n}","function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport Span from './span';\nimport SpanBase from './span-base';\nimport { generateRandomId, merge, now, getTime, extend, removeInvalidChars } from '../common/utils';\nimport { REUSABILITY_THRESHOLD, TRUNCATED_TYPE } from '../common/constants';\nimport { captureBreakdown as _captureBreakdown } from './breakdown';\n\nvar Transaction = function (_SpanBase) {\n  _inheritsLoose(Transaction, _SpanBase);\n\n  function Transaction(name, type, options) {\n    var _this;\n\n    _this = _SpanBase.call(this, name, type, options) || this;\n    _this.traceId = generateRandomId();\n    _this.marks = undefined;\n    _this.spans = [];\n    _this._activeSpans = {};\n    _this._activeTasks = new Set();\n    _this.blocked = false;\n    _this.captureTimings = false;\n    _this.breakdownTimings = [];\n    _this.sampleRate = _this.options.transactionSampleRate;\n    _this.sampled = Math.random() <= _this.sampleRate;\n    return _this;\n  }\n\n  var _proto = Transaction.prototype;\n\n  _proto.addMarks = function addMarks(obj) {\n    this.marks = merge(this.marks || {}, obj);\n  };\n\n  _proto.mark = function mark(key) {\n    var skey = removeInvalidChars(key);\n\n    var markTime = now() - this._start;\n\n    var custom = {};\n    custom[skey] = markTime;\n    this.addMarks({\n      custom: custom\n    });\n  };\n\n  _proto.canReuse = function canReuse() {\n    var threshold = this.options.reuseThreshold || REUSABILITY_THRESHOLD;\n    return !!this.options.canReuse && !this.ended && now() - this._start < threshold;\n  };\n\n  _proto.redefine = function redefine(name, type, options) {\n    if (name) {\n      this.name = name;\n    }\n\n    if (type) {\n      this.type = type;\n    }\n\n    if (options) {\n      this.options.reuseThreshold = options.reuseThreshold;\n      extend(this.options, options);\n    }\n  };\n\n  _proto.startSpan = function startSpan(name, type, options) {\n    var _this2 = this;\n\n    if (this.ended) {\n      return;\n    }\n\n    var opts = extend({}, options);\n\n    opts.onEnd = function (trc) {\n      _this2._onSpanEnd(trc);\n    };\n\n    opts.traceId = this.traceId;\n    opts.sampled = this.sampled;\n    opts.sampleRate = this.sampleRate;\n\n    if (!opts.parentId) {\n      opts.parentId = this.id;\n    }\n\n    var span = new Span(name, type, opts);\n    this._activeSpans[span.id] = span;\n\n    if (opts.blocking) {\n      this.addTask(span.id);\n    }\n\n    return span;\n  };\n\n  _proto.isFinished = function isFinished() {\n    return !this.blocked && this._activeTasks.size === 0;\n  };\n\n  _proto.detectFinish = function detectFinish() {\n    if (this.isFinished()) this.end();\n  };\n\n  _proto.end = function end(endTime) {\n    if (this.ended) {\n      return;\n    }\n\n    this.ended = true;\n    this._end = getTime(endTime);\n\n    for (var sid in this._activeSpans) {\n      var span = this._activeSpans[sid];\n      span.type = span.type + TRUNCATED_TYPE;\n      span.end(endTime);\n    }\n\n    this.callOnEnd();\n  };\n\n  _proto.captureBreakdown = function captureBreakdown() {\n    this.breakdownTimings = _captureBreakdown(this);\n  };\n\n  _proto.block = function block(flag) {\n    this.blocked = flag;\n\n    if (!this.blocked) {\n      this.detectFinish();\n    }\n  };\n\n  _proto.addTask = function addTask(taskId) {\n    if (!taskId) {\n      taskId = 'task-' + generateRandomId(16);\n    }\n\n    this._activeTasks.add(taskId);\n\n    return taskId;\n  };\n\n  _proto.removeTask = function removeTask(taskId) {\n    var deleted = this._activeTasks.delete(taskId);\n\n    deleted && this.detectFinish();\n  };\n\n  _proto.resetFields = function resetFields() {\n    this.spans = [];\n    this.sampleRate = 0;\n  };\n\n  _proto._onSpanEnd = function _onSpanEnd(span) {\n    this.spans.push(span);\n    delete this._activeSpans[span.id];\n    this.removeTask(span.id);\n  };\n\n  _proto.isManaged = function isManaged() {\n    return !!this.options.managed;\n  };\n\n  return Transaction;\n}(SpanBase);\n\nexport default Transaction;","import { LONG_TASK, LARGEST_CONTENTFUL_PAINT, FIRST_CONTENTFUL_PAINT, FIRST_INPUT, LAYOUT_SHIFT } from '../common/constants';\nimport { noop, PERF } from '../common/utils';\nimport Span from './span';\nexport var metrics = {\n  fid: 0,\n  fcp: 0,\n  tbt: {\n    start: Infinity,\n    duration: 0\n  },\n  cls: {\n    score: 0,\n    firstEntryTime: Number.NEGATIVE_INFINITY,\n    prevEntryTime: Number.NEGATIVE_INFINITY,\n    currentSessionScore: 0\n  },\n  longtask: {\n    count: 0,\n    duration: 0,\n    max: 0\n  }\n};\nvar LONG_TASK_THRESHOLD = 50;\nexport function createLongTaskSpans(longtasks, agg) {\n  var spans = [];\n\n  for (var i = 0; i < longtasks.length; i++) {\n    var _longtasks$i = longtasks[i],\n        name = _longtasks$i.name,\n        startTime = _longtasks$i.startTime,\n        duration = _longtasks$i.duration,\n        attribution = _longtasks$i.attribution;\n    var end = startTime + duration;\n    var span = new Span(\"Longtask(\" + name + \")\", LONG_TASK, {\n      startTime: startTime\n    });\n    agg.count++;\n    agg.duration += duration;\n    agg.max = Math.max(duration, agg.max);\n\n    if (attribution.length > 0) {\n      var _attribution$ = attribution[0],\n          _name = _attribution$.name,\n          containerType = _attribution$.containerType,\n          containerName = _attribution$.containerName,\n          containerId = _attribution$.containerId;\n      var customContext = {\n        attribution: _name,\n        type: containerType\n      };\n\n      if (containerName) {\n        customContext.name = containerName;\n      }\n\n      if (containerId) {\n        customContext.id = containerId;\n      }\n\n      span.addContext({\n        custom: customContext\n      });\n    }\n\n    span.end(end);\n    spans.push(span);\n  }\n\n  return spans;\n}\nexport function createFirstInputDelaySpan(fidEntries) {\n  var firstInput = fidEntries[0];\n\n  if (firstInput) {\n    var startTime = firstInput.startTime,\n        processingStart = firstInput.processingStart;\n    var span = new Span('First Input Delay', FIRST_INPUT, {\n      startTime: startTime\n    });\n    span.end(processingStart);\n    return span;\n  }\n}\nexport function createTotalBlockingTimeSpan(tbtObject) {\n  var start = tbtObject.start,\n      duration = tbtObject.duration;\n  var tbtSpan = new Span('Total Blocking Time', LONG_TASK, {\n    startTime: start\n  });\n  tbtSpan.end(start + duration);\n  return tbtSpan;\n}\nexport function calculateTotalBlockingTime(longtaskEntries) {\n  longtaskEntries.forEach(function (entry) {\n    var name = entry.name,\n        startTime = entry.startTime,\n        duration = entry.duration;\n\n    if (startTime < metrics.fcp) {\n      return;\n    }\n\n    if (name !== 'self' && name.indexOf('same-origin') === -1) {\n      return;\n    }\n\n    metrics.tbt.start = Math.min(metrics.tbt.start, startTime);\n    var blockingTime = duration - LONG_TASK_THRESHOLD;\n\n    if (blockingTime > 0) {\n      metrics.tbt.duration += blockingTime;\n    }\n  });\n}\nexport function calculateCumulativeLayoutShift(clsEntries) {\n  clsEntries.forEach(function (entry) {\n    if (!entry.hadRecentInput && entry.value) {\n      var shouldCreateNewSession = entry.startTime - metrics.cls.firstEntryTime > 5000 || entry.startTime - metrics.cls.prevEntryTime > 1000;\n\n      if (shouldCreateNewSession) {\n        metrics.cls.firstEntryTime = entry.startTime;\n        metrics.cls.currentSessionScore = 0;\n      }\n\n      metrics.cls.prevEntryTime = entry.startTime;\n      metrics.cls.currentSessionScore += entry.value;\n      metrics.cls.score = Math.max(metrics.cls.score, metrics.cls.currentSessionScore);\n    }\n  });\n}\nexport function captureObserverEntries(list, _ref) {\n  var isHardNavigation = _ref.isHardNavigation,\n      trStart = _ref.trStart;\n  var longtaskEntries = list.getEntriesByType(LONG_TASK).filter(function (entry) {\n    return entry.startTime >= trStart;\n  });\n  var longTaskSpans = createLongTaskSpans(longtaskEntries, metrics.longtask);\n  var result = {\n    spans: longTaskSpans,\n    marks: {}\n  };\n\n  if (!isHardNavigation) {\n    return result;\n  }\n\n  var lcpEntries = list.getEntriesByType(LARGEST_CONTENTFUL_PAINT);\n  var lastLcpEntry = lcpEntries[lcpEntries.length - 1];\n\n  if (lastLcpEntry) {\n    var lcp = parseInt(lastLcpEntry.startTime);\n    metrics.lcp = lcp;\n    result.marks.largestContentfulPaint = lcp;\n  }\n\n  var timing = PERF.timing;\n  var unloadDiff = timing.fetchStart - timing.navigationStart;\n  var fcpEntry = list.getEntriesByName(FIRST_CONTENTFUL_PAINT)[0];\n\n  if (fcpEntry) {\n    var fcp = parseInt(unloadDiff >= 0 ? fcpEntry.startTime - unloadDiff : fcpEntry.startTime);\n    metrics.fcp = fcp;\n    result.marks.firstContentfulPaint = fcp;\n  }\n\n  var fidEntries = list.getEntriesByType(FIRST_INPUT);\n  var fidSpan = createFirstInputDelaySpan(fidEntries);\n\n  if (fidSpan) {\n    metrics.fid = fidSpan.duration();\n    result.spans.push(fidSpan);\n  }\n\n  calculateTotalBlockingTime(longtaskEntries);\n  var clsEntries = list.getEntriesByType(LAYOUT_SHIFT);\n  calculateCumulativeLayoutShift(clsEntries);\n  return result;\n}\nexport var PerfEntryRecorder = function () {\n  function PerfEntryRecorder(callback) {\n    this.po = {\n      observe: noop,\n      disconnect: noop\n    };\n\n    if (window.PerformanceObserver) {\n      this.po = new PerformanceObserver(callback);\n    }\n  }\n\n  var _proto = PerfEntryRecorder.prototype;\n\n  _proto.start = function start(type) {\n    try {\n      this.po.observe({\n        type: type,\n        buffered: true\n      });\n    } catch (_) {}\n  };\n\n  _proto.stop = function stop() {\n    this.po.disconnect();\n  };\n\n  return PerfEntryRecorder;\n}();","import { Promise } from '../common/polyfills';\nimport Transaction from './transaction';\nimport { PerfEntryRecorder, captureObserverEntries, metrics, createTotalBlockingTimeSpan } from './metrics';\nimport { extend, getEarliestSpan, getLatestNonXHRSpan, getLatestXHRSpan, isPerfTypeSupported, generateRandomId } from '../common/utils';\nimport { captureNavigation } from './capture-navigation';\nimport { PAGE_LOAD, NAME_UNKNOWN, TRANSACTION_START, TRANSACTION_END, TEMPORARY_TYPE, TRANSACTION_TYPE_ORDER, LARGEST_CONTENTFUL_PAINT, LONG_TASK, PAINT, TRUNCATED_TYPE, FIRST_INPUT, LAYOUT_SHIFT, SESSION_TIMEOUT, PAGE_LOAD_DELAY } from '../common/constants';\nimport { addTransactionContext } from '../common/context';\nimport { __DEV__, state } from '../state';\nimport { slugifyUrl } from '../common/url';\n\nvar TransactionService = function () {\n  function TransactionService(logger, config) {\n    var _this = this;\n\n    this._config = config;\n    this._logger = logger;\n    this.currentTransaction = undefined;\n    this.respIntervalId = undefined;\n    this.recorder = new PerfEntryRecorder(function (list) {\n      var tr = _this.getCurrentTransaction();\n\n      if (tr && tr.captureTimings) {\n        var _tr$spans;\n\n        var isHardNavigation = tr.type === PAGE_LOAD;\n\n        var _captureObserverEntri = captureObserverEntries(list, {\n          isHardNavigation: isHardNavigation,\n          trStart: isHardNavigation ? 0 : tr._start\n        }),\n            spans = _captureObserverEntri.spans,\n            marks = _captureObserverEntri.marks;\n\n        (_tr$spans = tr.spans).push.apply(_tr$spans, spans);\n\n        tr.addMarks({\n          agent: marks\n        });\n      }\n    });\n  }\n\n  var _proto = TransactionService.prototype;\n\n  _proto.createCurrentTransaction = function createCurrentTransaction(name, type, options) {\n    var tr = new Transaction(name, type, options);\n    this.currentTransaction = tr;\n    return tr;\n  };\n\n  _proto.getCurrentTransaction = function getCurrentTransaction() {\n    if (this.currentTransaction && !this.currentTransaction.ended) {\n      return this.currentTransaction;\n    }\n  };\n\n  _proto.createOptions = function createOptions(options) {\n    var config = this._config.config;\n    var presetOptions = {\n      transactionSampleRate: config.transactionSampleRate\n    };\n    var perfOptions = extend(presetOptions, options);\n\n    if (perfOptions.managed) {\n      perfOptions = extend({\n        pageLoadTraceId: config.pageLoadTraceId,\n        pageLoadSampled: config.pageLoadSampled,\n        pageLoadSpanId: config.pageLoadSpanId,\n        pageLoadTransactionName: config.pageLoadTransactionName\n      }, perfOptions);\n    }\n\n    return perfOptions;\n  };\n\n  _proto.startManagedTransaction = function startManagedTransaction(name, type, perfOptions) {\n    var tr = this.getCurrentTransaction();\n    var isRedefined = false;\n\n    if (!tr) {\n      tr = this.createCurrentTransaction(name, type, perfOptions);\n    } else if (tr.canReuse() && perfOptions.canReuse) {\n      var redefineType = tr.type;\n      var currentTypeOrder = TRANSACTION_TYPE_ORDER.indexOf(tr.type);\n      var redefineTypeOrder = TRANSACTION_TYPE_ORDER.indexOf(type);\n\n      if (currentTypeOrder >= 0 && redefineTypeOrder < currentTypeOrder) {\n        redefineType = type;\n      }\n\n      if (__DEV__) {\n        this._logger.debug(\"redefining transaction(\" + tr.id + \", \" + tr.name + \", \" + tr.type + \")\", 'to', \"(\" + (name || tr.name) + \", \" + redefineType + \")\", tr);\n      }\n\n      tr.redefine(name, redefineType, perfOptions);\n      isRedefined = true;\n    } else {\n      if (__DEV__) {\n        this._logger.debug(\"ending previous transaction(\" + tr.id + \", \" + tr.name + \")\", tr);\n      }\n\n      tr.end();\n      tr = this.createCurrentTransaction(name, type, perfOptions);\n    }\n\n    if (tr.type === PAGE_LOAD) {\n      if (!isRedefined) {\n        this.recorder.start(LARGEST_CONTENTFUL_PAINT);\n        this.recorder.start(PAINT);\n        this.recorder.start(FIRST_INPUT);\n        this.recorder.start(LAYOUT_SHIFT);\n      }\n\n      if (perfOptions.pageLoadTraceId) {\n        tr.traceId = perfOptions.pageLoadTraceId;\n      }\n\n      if (perfOptions.pageLoadSampled) {\n        tr.sampled = perfOptions.pageLoadSampled;\n      }\n\n      if (tr.name === NAME_UNKNOWN && perfOptions.pageLoadTransactionName) {\n        tr.name = perfOptions.pageLoadTransactionName;\n      }\n    }\n\n    if (!isRedefined && this._config.get('monitorLongtasks')) {\n      this.recorder.start(LONG_TASK);\n    }\n\n    if (tr.sampled) {\n      tr.captureTimings = true;\n    }\n\n    return tr;\n  };\n\n  _proto.startTransaction = function startTransaction(name, type, options) {\n    var _this2 = this;\n\n    var perfOptions = this.createOptions(options);\n    var tr;\n    var fireOnstartHook = true;\n\n    if (perfOptions.managed) {\n      var current = this.currentTransaction;\n      tr = this.startManagedTransaction(name, type, perfOptions);\n\n      if (current === tr) {\n        fireOnstartHook = false;\n      }\n    } else {\n      tr = new Transaction(name, type, perfOptions);\n    }\n\n    tr.onEnd = function () {\n      return _this2.handleTransactionEnd(tr);\n    };\n\n    if (fireOnstartHook) {\n      if (__DEV__) {\n        this._logger.debug(\"startTransaction(\" + tr.id + \", \" + tr.name + \", \" + tr.type + \")\");\n      }\n\n      this._config.events.send(TRANSACTION_START, [tr]);\n    }\n\n    return tr;\n  };\n\n  _proto.handleTransactionEnd = function handleTransactionEnd(tr) {\n    var _this3 = this;\n\n    this.recorder.stop();\n    var currentUrl = window.location.href;\n    return Promise.resolve().then(function () {\n      var name = tr.name,\n          type = tr.type;\n      var lastHiddenStart = state.lastHiddenStart;\n\n      if (lastHiddenStart >= tr._start) {\n        if (__DEV__) {\n          _this3._logger.debug(\"transaction(\" + tr.id + \", \" + name + \", \" + type + \") was discarded! The page was hidden during the transaction!\");\n        }\n\n        return;\n      }\n\n      if (_this3.shouldIgnoreTransaction(name) || type === TEMPORARY_TYPE) {\n        if (__DEV__) {\n          _this3._logger.debug(\"transaction(\" + tr.id + \", \" + name + \", \" + type + \") is ignored\");\n        }\n\n        return;\n      }\n\n      if (type === PAGE_LOAD) {\n        var pageLoadTransactionName = _this3._config.get('pageLoadTransactionName');\n\n        if (name === NAME_UNKNOWN && pageLoadTransactionName) {\n          tr.name = pageLoadTransactionName;\n        }\n\n        if (tr.captureTimings) {\n          var cls = metrics.cls,\n              fid = metrics.fid,\n              tbt = metrics.tbt,\n              longtask = metrics.longtask;\n\n          if (tbt.duration > 0) {\n            tr.spans.push(createTotalBlockingTimeSpan(tbt));\n          }\n\n          tr.experience = {};\n\n          if (isPerfTypeSupported(LONG_TASK)) {\n            tr.experience.tbt = tbt.duration;\n          }\n\n          if (isPerfTypeSupported(LAYOUT_SHIFT)) {\n            tr.experience.cls = cls.score;\n          }\n\n          if (fid > 0) {\n            tr.experience.fid = fid;\n          }\n\n          if (longtask.count > 0) {\n            tr.experience.longtask = {\n              count: longtask.count,\n              sum: longtask.duration,\n              max: longtask.max\n            };\n          }\n        }\n\n        _this3.setSession(tr);\n      }\n\n      if (tr.name === NAME_UNKNOWN) {\n        tr.name = slugifyUrl(currentUrl);\n      }\n\n      captureNavigation(tr);\n\n      _this3.adjustTransactionTime(tr);\n\n      var breakdownMetrics = _this3._config.get('breakdownMetrics');\n\n      if (breakdownMetrics) {\n        tr.captureBreakdown();\n      }\n\n      var configContext = _this3._config.get('context');\n\n      addTransactionContext(tr, configContext);\n\n      _this3._config.events.send(TRANSACTION_END, [tr]);\n\n      if (__DEV__) {\n        _this3._logger.debug(\"end transaction(\" + tr.id + \", \" + tr.name + \", \" + tr.type + \")\", tr);\n      }\n    }, function (err) {\n      if (__DEV__) {\n        _this3._logger.debug(\"error ending transaction(\" + tr.id + \", \" + tr.name + \")\", err);\n      }\n    });\n  };\n\n  _proto.setSession = function setSession(tr) {\n    var session = this._config.get('session');\n\n    if (session) {\n      if (typeof session == 'boolean') {\n        tr.session = {\n          id: generateRandomId(16),\n          sequence: 1\n        };\n      } else {\n        if (session.timestamp && Date.now() - session.timestamp > SESSION_TIMEOUT) {\n          tr.session = {\n            id: generateRandomId(16),\n            sequence: 1\n          };\n        } else {\n          tr.session = {\n            id: session.id,\n            sequence: session.sequence ? session.sequence + 1 : 1\n          };\n        }\n      }\n\n      var sessionConfig = {\n        session: {\n          id: tr.session.id,\n          sequence: tr.session.sequence,\n          timestamp: Date.now()\n        }\n      };\n\n      this._config.setConfig(sessionConfig);\n\n      this._config.setLocalConfig(sessionConfig, true);\n    }\n  };\n\n  _proto.adjustTransactionTime = function adjustTransactionTime(transaction) {\n    var spans = transaction.spans;\n    var earliestSpan = getEarliestSpan(spans);\n\n    if (earliestSpan && earliestSpan._start < transaction._start) {\n      transaction._start = earliestSpan._start;\n    }\n\n    var latestSpan = getLatestNonXHRSpan(spans) || {};\n    var latestSpanEnd = latestSpan._end || 0;\n\n    if (transaction.type === PAGE_LOAD) {\n      var transactionEndWithoutDelay = transaction._end - PAGE_LOAD_DELAY;\n      var lcp = metrics.lcp || 0;\n      var latestXHRSpan = getLatestXHRSpan(spans) || {};\n      var latestXHRSpanEnd = latestXHRSpan._end || 0;\n      transaction._end = Math.max(latestSpanEnd, latestXHRSpanEnd, lcp, transactionEndWithoutDelay);\n    } else if (latestSpanEnd > transaction._end) {\n      transaction._end = latestSpanEnd;\n    }\n\n    this.truncateSpans(spans, transaction._end);\n  };\n\n  _proto.truncateSpans = function truncateSpans(spans, transactionEnd) {\n    for (var i = 0; i < spans.length; i++) {\n      var span = spans[i];\n\n      if (span._end > transactionEnd) {\n        span._end = transactionEnd;\n        span.type += TRUNCATED_TYPE;\n      }\n\n      if (span._start > transactionEnd) {\n        span._start = transactionEnd;\n      }\n    }\n  };\n\n  _proto.shouldIgnoreTransaction = function shouldIgnoreTransaction(transactionName) {\n    var ignoreList = this._config.get('ignoreTransactions');\n\n    if (ignoreList && ignoreList.length) {\n      for (var i = 0; i < ignoreList.length; i++) {\n        var element = ignoreList[i];\n\n        if (typeof element.test === 'function') {\n          if (element.test(transactionName)) {\n            return true;\n          }\n        } else if (element === transactionName) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  _proto.startSpan = function startSpan(name, type, options) {\n    var tr = this.getCurrentTransaction();\n\n    if (!tr) {\n      tr = this.createCurrentTransaction(undefined, TEMPORARY_TYPE, this.createOptions({\n        canReuse: true,\n        managed: true\n      }));\n    }\n\n    var span = tr.startSpan(name, type, options);\n\n    if (__DEV__) {\n      this._logger.debug(\"startSpan(\" + name + \", \" + span.type + \")\", \"on transaction(\" + tr.id + \", \" + tr.name + \")\");\n    }\n\n    return span;\n  };\n\n  _proto.endSpan = function endSpan(span, context) {\n    if (!span) {\n      return;\n    }\n\n    if (__DEV__) {\n      var tr = this.getCurrentTransaction();\n      tr && this._logger.debug(\"endSpan(\" + span.name + \", \" + span.type + \")\", \"on transaction(\" + tr.id + \", \" + tr.name + \")\");\n    }\n\n    span.end(null, context);\n  };\n\n  return TransactionService;\n}();\n\nexport default TransactionService;","import { registerServices as registerErrorServices } from './error-logging';\nimport { registerServices as registerPerfServices } from './performance-monitoring';\nimport { ServiceFactory } from './common/service-factory';\nimport { isPlatformSupported, scheduleMicroTask, scheduleMacroTask, isBrowser } from './common/utils';\nimport { patchAll, patchEventHandler } from './common/patching';\nimport { observePageVisibility, observePageClicks } from './common/observers';\nimport { PAGE_LOAD_DELAY, PAGE_LOAD, ERROR, CONFIG_SERVICE, LOGGING_SERVICE, TRANSACTION_SERVICE, APM_SERVER, PERFORMANCE_MONITORING, ERROR_LOGGING, EVENT_TARGET, CLICK } from './common/constants';\nimport { getInstrumentationFlags } from './common/instrument';\nimport afterFrame from './common/after-frame';\nimport { bootstrap } from './bootstrap';\nimport { createTracer } from './opentracing';\n\nfunction createServiceFactory() {\n  registerPerfServices();\n  registerErrorServices();\n  var serviceFactory = new ServiceFactory();\n  return serviceFactory;\n}\n\nexport { createServiceFactory, ServiceFactory, patchAll, patchEventHandler, isPlatformSupported, isBrowser, getInstrumentationFlags, createTracer, scheduleMicroTask, scheduleMacroTask, afterFrame, ERROR, PAGE_LOAD_DELAY, PAGE_LOAD, CONFIG_SERVICE, LOGGING_SERVICE, TRANSACTION_SERVICE, APM_SERVER, PERFORMANCE_MONITORING, ERROR_LOGGING, EVENT_TARGET, CLICK, bootstrap, observePageVisibility, observePageClicks };","import PerformanceMonitoring from './performance-monitoring';\nimport TransactionService from './transaction-service';\nimport { APM_SERVER, CONFIG_SERVICE, LOGGING_SERVICE, TRANSACTION_SERVICE, PERFORMANCE_MONITORING } from '../common/constants';\nimport { serviceCreators } from '../common/service-factory';\n\nfunction registerServices() {\n  serviceCreators[TRANSACTION_SERVICE] = function (serviceFactory) {\n    var _serviceFactory$getSe = serviceFactory.getService([LOGGING_SERVICE, CONFIG_SERVICE]),\n        loggingService = _serviceFactory$getSe[0],\n        configService = _serviceFactory$getSe[1];\n\n    return new TransactionService(loggingService, configService);\n  };\n\n  serviceCreators[PERFORMANCE_MONITORING] = function (serviceFactory) {\n    var _serviceFactory$getSe2 = serviceFactory.getService([APM_SERVER, CONFIG_SERVICE, LOGGING_SERVICE, TRANSACTION_SERVICE]),\n        apmServer = _serviceFactory$getSe2[0],\n        configService = _serviceFactory$getSe2[1],\n        loggingService = _serviceFactory$getSe2[2],\n        transactionService = _serviceFactory$getSe2[3];\n\n    return new PerformanceMonitoring(apmServer, configService, loggingService, transactionService);\n  };\n}\n\nexport { registerServices };","import ErrorLogging from './error-logging';\nimport { CONFIG_SERVICE, TRANSACTION_SERVICE, ERROR_LOGGING, APM_SERVER } from '../common/constants';\nimport { serviceCreators } from '../common/service-factory';\n\nfunction registerServices() {\n  serviceCreators[ERROR_LOGGING] = function (serviceFactory) {\n    var _serviceFactory$getSe = serviceFactory.getService([APM_SERVER, CONFIG_SERVICE, TRANSACTION_SERVICE]),\n        apmServer = _serviceFactory$getSe[0],\n        configService = _serviceFactory$getSe[1],\n        transactionService = _serviceFactory$getSe[2];\n\n    return new ErrorLogging(apmServer, configService, transactionService);\n  };\n}\n\nexport { registerServices };","import { QUEUE_ADD_TRANSACTION, QUEUE_FLUSH } from '../constants';\nimport { state } from '../../state';\nimport { now } from '../utils';\nexport function observePageVisibility(configService, transactionService) {\n  if (document.visibilityState === 'hidden') {\n    state.lastHiddenStart = 0;\n  }\n\n  var visibilityChangeHandler = function visibilityChangeHandler() {\n    if (document.visibilityState === 'hidden') {\n      onPageHidden(configService, transactionService);\n    }\n  };\n\n  var pageHideHandler = function pageHideHandler() {\n    return onPageHidden(configService, transactionService);\n  };\n\n  var useCapture = true;\n  window.addEventListener('visibilitychange', visibilityChangeHandler, useCapture);\n  window.addEventListener('pagehide', pageHideHandler, useCapture);\n  return function () {\n    window.removeEventListener('visibilitychange', visibilityChangeHandler, useCapture);\n    window.removeEventListener('pagehide', pageHideHandler, useCapture);\n  };\n}\n\nfunction onPageHidden(configService, transactionService) {\n  var tr = transactionService.getCurrentTransaction();\n\n  if (tr) {\n    var unobserve = configService.observeEvent(QUEUE_ADD_TRANSACTION, function () {\n      configService.dispatchEvent(QUEUE_FLUSH);\n      state.lastHiddenStart = now();\n      unobserve();\n    });\n    tr.end();\n  } else {\n    configService.dispatchEvent(QUEUE_FLUSH);\n    state.lastHiddenStart = now();\n  }\n}","import { USER_INTERACTION } from '../constants';\nexport function observePageClicks(transactionService) {\n  var clickHandler = function clickHandler(event) {\n    if (event.target instanceof Element) {\n      createUserInteractionTransaction(transactionService, event.target);\n    }\n  };\n\n  var eventName = 'click';\n  var useCapture = true;\n  window.addEventListener(eventName, clickHandler, useCapture);\n  return function () {\n    window.removeEventListener(eventName, clickHandler, useCapture);\n  };\n}\n\nfunction createUserInteractionTransaction(transactionService, target) {\n  var _getTransactionMetada = getTransactionMetadata(target),\n      transactionName = _getTransactionMetada.transactionName,\n      context = _getTransactionMetada.context;\n\n  var tr = transactionService.startTransaction(\"Click - \" + transactionName, USER_INTERACTION, {\n    managed: true,\n    canReuse: true,\n    reuseThreshold: 300\n  });\n\n  if (tr && context) {\n    tr.addContext(context);\n  }\n}\n\nfunction getTransactionMetadata(target) {\n  var metadata = {\n    transactionName: null,\n    context: null\n  };\n  var tagName = target.tagName.toLowerCase();\n  var transactionName = tagName;\n\n  if (!!target.dataset.transactionName) {\n    transactionName = target.dataset.transactionName;\n  } else {\n    var name = target.getAttribute('name');\n\n    if (!!name) {\n      transactionName = tagName + \"[\\\"\" + name + \"\\\"]\";\n    }\n  }\n\n  metadata.transactionName = transactionName;\n  var classes = target.getAttribute('class');\n\n  if (classes) {\n    metadata.context = {\n      custom: {\n        classes: classes\n      }\n    };\n  }\n\n  return metadata;\n}","import { getInstrumentationFlags, PAGE_LOAD_DELAY, PAGE_LOAD, ERROR, CONFIG_SERVICE, LOGGING_SERVICE, TRANSACTION_SERVICE, PERFORMANCE_MONITORING, ERROR_LOGGING, APM_SERVER, EVENT_TARGET, CLICK, observePageVisibility, observePageClicks } from '@elastic/apm-rum-core';\n\nvar ApmBase = function () {\n  function ApmBase(serviceFactory, disable) {\n    this._disable = disable;\n    this.serviceFactory = serviceFactory;\n    this._initialized = false;\n  }\n\n  var _proto = ApmBase.prototype;\n\n  _proto.isEnabled = function isEnabled() {\n    return !this._disable;\n  };\n\n  _proto.isActive = function isActive() {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE);\n    return this.isEnabled() && this._initialized && configService.get('active');\n  };\n\n  _proto.init = function init(config) {\n    var _this = this;\n\n    if (this.isEnabled() && !this._initialized) {\n      this._initialized = true;\n\n      var _this$serviceFactory$ = this.serviceFactory.getService([CONFIG_SERVICE, LOGGING_SERVICE, TRANSACTION_SERVICE]),\n          configService = _this$serviceFactory$[0],\n          loggingService = _this$serviceFactory$[1],\n          transactionService = _this$serviceFactory$[2];\n\n      configService.setVersion('5.12.0');\n      this.config(config);\n      var logLevel = configService.get('logLevel');\n      loggingService.setLevel(logLevel);\n      var isConfigActive = configService.get('active');\n\n      if (isConfigActive) {\n        this.serviceFactory.init();\n        var flags = getInstrumentationFlags(configService.get('instrument'), configService.get('disableInstrumentations'));\n        var performanceMonitoring = this.serviceFactory.getService(PERFORMANCE_MONITORING);\n        performanceMonitoring.init(flags);\n\n        if (flags[ERROR]) {\n          var errorLogging = this.serviceFactory.getService(ERROR_LOGGING);\n          errorLogging.registerListeners();\n        }\n\n        if (configService.get('session')) {\n          var localConfig = configService.getLocalConfig();\n\n          if (localConfig && localConfig.session) {\n            configService.setConfig({\n              session: localConfig.session\n            });\n          }\n        }\n\n        var sendPageLoad = function sendPageLoad() {\n          return flags[PAGE_LOAD] && _this._sendPageLoadMetrics();\n        };\n\n        if (configService.get('centralConfig')) {\n          this.fetchCentralConfig().then(sendPageLoad);\n        } else {\n          sendPageLoad();\n        }\n\n        observePageVisibility(configService, transactionService);\n\n        if (flags[EVENT_TARGET] && flags[CLICK]) {\n          observePageClicks(transactionService);\n        }\n      } else {\n        this._disable = true;\n        loggingService.warn('RUM agent is inactive');\n      }\n    }\n\n    return this;\n  };\n\n  _proto.fetchCentralConfig = function fetchCentralConfig() {\n    var _this$serviceFactory$2 = this.serviceFactory.getService([APM_SERVER, LOGGING_SERVICE, CONFIG_SERVICE]),\n        apmServer = _this$serviceFactory$2[0],\n        loggingService = _this$serviceFactory$2[1],\n        configService = _this$serviceFactory$2[2];\n\n    return apmServer.fetchConfig(configService.get('serviceName'), configService.get('environment')).then(function (config) {\n      var transactionSampleRate = config['transaction_sample_rate'];\n\n      if (transactionSampleRate) {\n        transactionSampleRate = Number(transactionSampleRate);\n        var _config2 = {\n          transactionSampleRate: transactionSampleRate\n        };\n\n        var _configService$valida = configService.validate(_config2),\n            invalid = _configService$valida.invalid;\n\n        if (invalid.length === 0) {\n          configService.setConfig(_config2);\n        } else {\n          var _invalid$ = invalid[0],\n              key = _invalid$.key,\n              value = _invalid$.value,\n              allowed = _invalid$.allowed;\n          loggingService.warn(\"invalid value \\\"\" + value + \"\\\" for \" + key + \". Allowed: \" + allowed + \".\");\n        }\n      }\n\n      return config;\n    }).catch(function (error) {\n      loggingService.warn('failed fetching config:', error);\n    });\n  };\n\n  _proto._sendPageLoadMetrics = function _sendPageLoadMetrics() {\n    var tr = this.startTransaction(undefined, PAGE_LOAD, {\n      managed: true,\n      canReuse: true\n    });\n\n    if (!tr) {\n      return;\n    }\n\n    tr.addTask(PAGE_LOAD);\n\n    var sendPageLoadMetrics = function sendPageLoadMetrics() {\n      setTimeout(function () {\n        return tr.removeTask(PAGE_LOAD);\n      }, PAGE_LOAD_DELAY);\n    };\n\n    if (document.readyState === 'complete') {\n      sendPageLoadMetrics();\n    } else {\n      window.addEventListener('load', sendPageLoadMetrics);\n    }\n  };\n\n  _proto.observe = function observe(name, fn) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE);\n    configService.events.observe(name, fn);\n  };\n\n  _proto.config = function config(_config) {\n    var _this$serviceFactory$3 = this.serviceFactory.getService([CONFIG_SERVICE, LOGGING_SERVICE]),\n        configService = _this$serviceFactory$3[0],\n        loggingService = _this$serviceFactory$3[1];\n\n    var _configService$valida2 = configService.validate(_config),\n        missing = _configService$valida2.missing,\n        invalid = _configService$valida2.invalid,\n        unknown = _configService$valida2.unknown;\n\n    if (unknown.length > 0) {\n      var message = 'Unknown config options are specified for RUM agent: ' + unknown.join(', ');\n      loggingService.warn(message);\n    }\n\n    if (missing.length === 0 && invalid.length === 0) {\n      configService.setConfig(_config);\n    } else {\n      var separator = ', ';\n      var _message = \"RUM agent isn't correctly configured. \";\n\n      if (missing.length > 0) {\n        _message += missing.join(separator) + ' is missing';\n\n        if (invalid.length > 0) {\n          _message += separator;\n        }\n      }\n\n      invalid.forEach(function (_ref, index) {\n        var key = _ref.key,\n            value = _ref.value,\n            allowed = _ref.allowed;\n        _message += key + \" \\\"\" + value + \"\\\" contains invalid characters! (allowed: \" + allowed + \")\" + (index !== invalid.length - 1 ? separator : '');\n      });\n      loggingService.error(_message);\n      configService.setConfig({\n        active: false\n      });\n    }\n  };\n\n  _proto.setUserContext = function setUserContext(userContext) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE);\n    configService.setUserContext(userContext);\n  };\n\n  _proto.setCustomContext = function setCustomContext(customContext) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE);\n    configService.setCustomContext(customContext);\n  };\n\n  _proto.addLabels = function addLabels(labels) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE);\n    configService.addLabels(labels);\n  };\n\n  _proto.setInitialPageLoadName = function setInitialPageLoadName(name) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE);\n    configService.setConfig({\n      pageLoadTransactionName: name\n    });\n  };\n\n  _proto.startTransaction = function startTransaction(name, type, options) {\n    if (this.isEnabled()) {\n      var transactionService = this.serviceFactory.getService(TRANSACTION_SERVICE);\n      return transactionService.startTransaction(name, type, options);\n    }\n  };\n\n  _proto.startSpan = function startSpan(name, type, options) {\n    if (this.isEnabled()) {\n      var transactionService = this.serviceFactory.getService(TRANSACTION_SERVICE);\n      return transactionService.startSpan(name, type, options);\n    }\n  };\n\n  _proto.getCurrentTransaction = function getCurrentTransaction() {\n    if (this.isEnabled()) {\n      var transactionService = this.serviceFactory.getService(TRANSACTION_SERVICE);\n      return transactionService.getCurrentTransaction();\n    }\n  };\n\n  _proto.captureError = function captureError(error) {\n    if (this.isEnabled()) {\n      var errorLogging = this.serviceFactory.getService(ERROR_LOGGING);\n      return errorLogging.logError(error);\n    }\n  };\n\n  _proto.addFilter = function addFilter(fn) {\n    var configService = this.serviceFactory.getService(CONFIG_SERVICE);\n    configService.addFilter(fn);\n  };\n\n  return ApmBase;\n}();\n\nexport { ApmBase as default };","import { XMLHTTPREQUEST, FETCH, HISTORY, PAGE_LOAD, ERROR, EVENT_TARGET, CLICK } from './constants';\nexport function getInstrumentationFlags(instrument, disabledInstrumentations) {\n  var _flags;\n\n  var flags = (_flags = {}, _flags[XMLHTTPREQUEST] = false, _flags[FETCH] = false, _flags[HISTORY] = false, _flags[PAGE_LOAD] = false, _flags[ERROR] = false, _flags[EVENT_TARGET] = false, _flags[CLICK] = false, _flags);\n\n  if (!instrument) {\n    return flags;\n  }\n\n  Object.keys(flags).forEach(function (key) {\n    if (disabledInstrumentations.indexOf(key) === -1) {\n      flags[key] = true;\n    }\n  });\n  return flags;\n}","import { createServiceFactory, bootstrap, isBrowser } from '@elastic/apm-rum-core';\nimport ApmBase from './apm-base';\n\nfunction getApmBase() {\n  if (isBrowser && window.elasticApm) {\n    return window.elasticApm;\n  }\n\n  var enabled = bootstrap();\n  var serviceFactory = createServiceFactory();\n  var apmBase = new ApmBase(serviceFactory, !enabled);\n\n  if (isBrowser) {\n    window.elasticApm = apmBase;\n  }\n\n  return apmBase;\n}\n\nvar apmBase = getApmBase();\nvar init = apmBase.init.bind(apmBase);\nexport default init;\nexport { init, apmBase, ApmBase, apmBase as apm };","\nimport { init as initApm } from '@elastic/apm-rum'\nvar apm = initApm({\n  // Set required service name (allowed characters: a-z, A-Z, 0-9, -, _, and space)\n  serviceName: 'rum-transaction-demo',\n  // Set the version of your application\n  // Used on the APM Server to find the right sourcemap\n  serviceVersion: '0.0.1',\n  environment: 'demo',\n  serverUrl: 'http://localhost:8200',\n  // apmRequest: ({ xhr }) => {\n  //   xhr.setRequestHeader('X-Forwarded-For', '220.244.41.16')\n  //   return true;\n  // }\n})\n\nexport default apm;","let isPolling = false;\n\nexport async function poll() {\n    if (isPolling) {\n        console.log('Already polling');\n        return;\n    }\n    isPolling = true;\n    await startPolling();\n}\n\nasync function startPolling() {\n    while (isPolling) {\n        console.log('scheduling fetch...');\n        await new Promise(r => setTimeout(r, 4000));\n        await fetch('https://example.com', {\n            mode: 'no-cors',\n        });\n    }\n}\n\nexport function stopPoll() {\n    if (!isPolling) {\n        return;\n    }\n    console.log('stopping polling.');\n    isPolling = false;\n}\n","import { apm } from '@elastic/apm-rum';\n\nexport async function measureTime() {\n    console.log('adding custom span');\n    const span = apm.startSpan('wait-for-timer', 'custom-span', { blocking: true });\n    const ms = Math.floor(Math.random() * 3000);\n    console.log('timeout ms:', ms);\n    await new Promise(r => setTimeout(r, ms));\n    span.end();\n}\n","import apm from './apm';\nimport { poll, stopPoll } from './poll';\nimport { measureTime } from './custom-span';\nvar btn1 = document.querySelector('#btn1');\nbtn1.addEventListener('click', () => {\n    measureTime().then().catch(err => apm.captureError(err));\n});\n\nvar btn2 = document.querySelector('#btn2');\nbtn2.addEventListener('click', () => {\n    const div = document.querySelector('#cat-div');\n    div.innerHTML = '';\n    const span = apm.startSpan('create Image element', 'resource-load', { blocking: true });\n    fetch('https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Cat03.jpg/1200px-Cat03.jpg')\n        .then(response => response.blob())\n        .then(imageBlob => {\n            // Then create a local URL for that image and print it \n            const imageObjectURL = URL.createObjectURL(imageBlob);\n            const imageEl = document.createElement('img');\n            imageEl.setAttribute('src', imageObjectURL);\n            imageEl.setAttribute('width', 300);\n            imageEl.setAttribute('height', 300);\n            let div = document.querySelector('#cat-div');\n            div.appendChild(imageEl);\n            span.end();\n        });\n});\n\nvar btn3 = document.querySelector('#btn3');\nbtn3.addEventListener('click', () => {\n    poll().then();\n});\n\nvar btn4 = document.querySelector('#btn4');\nbtn4.addEventListener('click', () => {\n    stopPoll();\n});\n\nvar btn5 = document.querySelector('#btn5');\nbtn5.addEventListener('click', () => {\n    window.history.pushState({}, '', '#foo');\n    measureTime().then().catch(err => apm.captureError(err));\n});\n"],"sourceRoot":""}